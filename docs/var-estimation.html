<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>8&nbsp; Estimation – Weather Shocks</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./dsge-theory.html" rel="next">
<link href="./data-climate-projections.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-ea4e51666191dd6ded9f775c5bce66c9.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark-e845f871f76c909dd0a2a1d88316b656.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-87ec474df7c9426c554836db57f7b3fe.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark-c8ec05b12fea21112c9e9d964ceda114.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    TeX: {
      extensions: ["color.js", "bbox.js"],
      Macros: {
        highlightpurple: ["\\bbox[5px,border:0px,background:#F3E6EF]{\\color{wongPurple}{\\mathbf{#1}}}", 1],
        highlightgreen:  ["\\bbox[5px,border:0px,background:#E9F5EF]{\\color{wongGreen}{\\mathbf{#1}}}", 1],
        highlightblue:   ["\\bbox[5px,border:0px,background:#E6F1F9]{\\color{wongBlue}{\\mathbf{#1}}}", 1],
        highlightorange: ["\\bbox[5px,border:0px,background:#FBEFE5]{\\color{wongOrange}{\\mathbf{#1}}}", 1],
        highlightgold:   ["\\bbox[5px,border:0px,background:#FFF5E0]{\\color{wongGold}{\\mathbf{#1}}}", 1],
        highlightlightblue:["\\bbox[5px,border:0px,background:#EEF8FD]{\\color{wongLightBlue}{\\mathbf{#1}}}", 1],
        highlightgris:   ["\\bbox[5px,border:0px,background:#F1F2F3]{\\color{gris}{\\mathbf{#1}}}", 1]
      }
    }
  });
</script>
<script type="text/x-mathjax-config">
	MathJax.Hub.Register.StartupHook("TeX color Ready", function() {
	     MathJax.Extension["TeX/color"].colors["wongBlack"] = '#000000';
		 MathJax.Extension["TeX/color"].colors["wongGold"] = '#E69F00';
		 MathJax.Extension["TeX/color"].colors["wongLightBlue"] = '#56B4E9';
		 MathJax.Extension["TeX/color"].colors["wongGreen"] = '#009E73';
		 MathJax.Extension["TeX/color"].colors["wongYellow"] = '#F0E442';
		 MathJax.Extension["TeX/color"].colors["wongBlue"] = '#0072B2';
		 MathJax.Extension["TeX/color"].colors["wongOrange"] = '#D55E00';
		 MathJax.Extension["TeX/color"].colors["wongPurple"] = '#CC79A7';
		 
		 
		 MathJax.Extension["TeX/color"].colors["IBMBlue"] = '#648FFF';
		 MathJax.Extension["TeX/color"].colors["IBMPurple"] = '#785EF0';
		 MathJax.Extension["TeX/color"].colors["IBMMagenta"] = '#DC267F';
		 MathJax.Extension["TeX/color"].colors["IBMOrange"] = '#FE6100';
		 MathJax.Extension["TeX/color"].colors["IBMYellow"] = '#FFB000';
	});
</script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Weather Shocks</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/3wen/weathershocks"> <i class="bi bi-github" role="img" aria-label="GitHub">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./var-estimation.html">II. VAR</a></li><li class="breadcrumb-item"><a href="./var-estimation.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Estimation</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Index</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Useful Functions</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">I. Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Maps</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-weather-download.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Weather Data: Download</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-weather-missing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Weather Data: Missing Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-weather-metrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Weather Data: Metrics</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-macro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Merge With Macroeconomic Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-climate-projections.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Climate Projection</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">II. VAR</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./var-estimation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Estimation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">III. DSGE</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dsge-theory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">The Theoretical Model</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./dsge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Estimation</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#sec-var-settions" id="toc-sec-var-settions" class="nav-link active" data-scroll-target="#sec-var-settions"><span class="header-section-number">8.1</span> Settings</a></li>
  <li><a href="#load-data" id="toc-load-data" class="nav-link" data-scroll-target="#load-data"><span class="header-section-number">8.2</span> Load Data</a></li>
  <li><a href="#estimation" id="toc-estimation" class="nav-link" data-scroll-target="#estimation"><span class="header-section-number">8.3</span> Estimation</a>
  <ul>
  <li><a href="#sec-restricted-var" id="toc-sec-restricted-var" class="nav-link" data-scroll-target="#sec-restricted-var"><span class="header-section-number">8.3.1</span> Restricted VAR</a></li>
  <li><a href="#sec-svar" id="toc-sec-svar" class="nav-link" data-scroll-target="#sec-svar"><span class="header-section-number">8.3.2</span> Structural VAR</a></li>
  <li><a href="#fisher-test" id="toc-fisher-test" class="nav-link" data-scroll-target="#fisher-test"><span class="header-section-number">8.3.3</span> Fisher Test</a></li>
  </ul></li>
  <li><a href="#sec-var-irfs" id="toc-sec-var-irfs" class="nav-link" data-scroll-target="#sec-var-irfs"><span class="header-section-number">8.4</span> IRFs</a>
  <ul>
  <li><a href="#monte-carlo-simulations" id="toc-monte-carlo-simulations" class="nav-link" data-scroll-target="#monte-carlo-simulations"><span class="header-section-number">8.4.1</span> Monte Carlo Simulations</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./var-estimation.html">II. VAR</a></li><li class="breadcrumb-item"><a href="./var-estimation.html"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Estimation</span></a></li></ol></nav>
<div class="quarto-title">
<h1 class="title"><span id="sec-var" class="quarto-section-identifier"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Estimation</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="hidden">
$$
<p>$$</p>
</div>
<div class="hidden">
<p><span class="math display">\[
\definecolor{wongBlue}{RGB}{0, 114, 178}
\definecolor{wongBlack}{RGB}{0,0,0}
\definecolor{wongGold}{RGB}{230, 159, 0}
\definecolor{wongLightBlue}{RGB}{86, 180, 233}
\definecolor{wongGreen}{RGB}{0, 158, 115}
\definecolor{wongYellow}{RGB}{240, 228, 66}
\definecolor{wongBlue}{RGB}{0, 114, 178}
\definecolor{wongOrange}{RGB}{213, 94, 0}
\definecolor{wongPurple}{RGB}{204, 121, 167}
\definecolor{gris}{HTML}{949698}
\definecolor{rcp26}{RGB}{39, 55, 122}
\definecolor{rcp45}{RGB}{112, 159, 200}
\definecolor{rcp60}{RGB}{222, 99, 43}
\definecolor{rcp85}{RGB}{205, 16, 32}
\]</span></p>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Objectives of this page
</div>
</div>
<div class="callout-body-container callout-body">
<p>This page presents the estimation of a VAR model using the dataset built in <a href="data-macro.html" class="quarto-xref">Chapter&nbsp;<span>6</span></a>.</p>
<p>We first estimate a restricted VAR (<a href="#sec-restricted-var" class="quarto-xref"><span>Section 8.3.1</span></a>) to encode block exogeneity: <span id="highlight-purple">the weather</span> sits in one exogenous block, <span id="highlight-orange">trading-partners’ output</span> in a second exogenous block, and <span id="highlight-blue">national variables</span> in a third block that can be influenced by the first two.</p>
<p>We then impose contemporaneous restrictions and <strong>estimate a SVAR</strong> (<a href="#sec-svar" class="quarto-xref"><span>Section 8.3.2</span></a>).</p>
<p>Finally, we shock the weather equation and examine transmission to the rest of the system through <strong>impulse response functions</strong> (IRFs) (<a href="#sec-var-irfs" class="quarto-xref"><span>Section 8.4</span></a>).</p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.2
✔ ggplot2   4.0.0     ✔ tibble    3.3.0
✔ lubridate 1.9.4     ✔ tidyr     1.3.1
✔ purrr     1.1.0     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
</div>
<section id="sec-var-settions" class="level2" data-number="8.1">
<h2 data-number="8.1" class="anchored" data-anchor-id="sec-var-settions"><span class="header-section-number">8.1</span> Settings</h2>
<p>We will use the following variables in the VAR model.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>variables_types <span class="ot">&lt;-</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="st">"smdi_obs"</span>, <span class="st">"climate"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">"wy_obs"</span>, <span class="st">"world"</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"y_obs"</span>, <span class="st">"domestic"</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">"y_a_obs"</span>, <span class="st">"domestic"</span>,</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>      <span class="st">"h_obs"</span>, <span class="st">"domestic"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>      <span class="st">"c_obs"</span>, <span class="st">"domestic"</span>,</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>      <span class="st">"i_obs"</span>, <span class="st">"domestic"</span>,</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"reer_obs"</span>, <span class="st">"domestic"</span>),</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">byrow =</span> T</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that their order is important. Also, we identified them with respect to the block they will be in:</p>
<ul>
<li><span id="highlight-purple">Weather block</span>: drought index <span class="math inline">\((\hat{\omega}_t)\)</span>. The climate block is going to be exogenous.</li>
<li><span id="highlight-orange">Foreign block</span>: rest-of-world GDP <span class="math inline">\((\hat{y}_t^\star)\)</span>. The variable that represents the rest of the world (here, the top trading partners). This block will not be influenced by the variations of the national weather, to reflect the idea that the country of interest is a small open economy.</li>
<li><span id="highlight-blue">Domestic block</span>: <span class="math inline">\(\{\hat{y}_t, \hat{y}_t^A, \hat{\imath}_t, \hat{h}_t, \hat{q}_t, \widehat{rer}_t\}\)</span>.</li>
</ul>
<p>To impose the restictions in the VAR, we will set to <span class="math inline">\(0\)</span> some coefficients in the matrix of lag coefficients. <span id="eq-VAR"><span class="math display">\[
\begin{equation}%
\begin{bmatrix}
\colorbox{wongPurple!17}{\textbf{\textcolor{wongPurple}{$X_t^W$}}}\\
\colorbox{wongOrange!17}{\textbf{\textcolor{wongOrange}{$X_t^\star$}}}\\
\colorbox{wongBlue!17}{\textbf{\textcolor{wongBlue}{$X_{t}^{D}$}}}%
\end{bmatrix}
=C+\sum_{l=1}^{p}%
\begin{bmatrix}
A_{l}^{11} &amp; \colorbox{wongGold!17}{\textbf{\textcolor{wongGold}{$0$}}} &amp; \colorbox{wongGold!17}{\textbf{\textcolor{wongGold}{$0$}}}\\
\colorbox{wongGold!17}{\textbf{\textcolor{wongGold}{$0$}}} &amp; A_{l}^{22} &amp; \colorbox{wongGold!17}{\textbf{\textcolor{wongGold}{$0$}}}\\
A_{l}^{31} &amp; A_{l}^{32} &amp; A_{l}^{33}%
\end{bmatrix}%
\begin{bmatrix}
\colorbox{wongPurple!17}{\textbf{\textcolor{wongPurple}{$X_{t-l}^W$}}}\\
\colorbox{wongOrange!17}{\textbf{\textcolor{wongOrange}{$X_{t-l}^{\star}$}}}\\
\colorbox{wongBlue!17}{\textbf{\textcolor{wongBlue}{$X_{t-l}^{D}$}}}%
\end{bmatrix}
+%
\begin{bmatrix}
\eta_{t}^{W}\\
\eta_{t}^{\star}\\
\eta_{t}^{D}%
\end{bmatrix}
,
\end{equation}
\tag{8.1}\]</span></span></p>
<p>Let us put the name of the exogenous variables in a vector of characters:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>variables_exo <span class="ot">&lt;-</span> variables_types[,<span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We set the number of lags to 1:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="dv">1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The number of variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>N <span class="ot">&lt;-</span> <span class="fu">length</span>(variables_exo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We define a function, <code class="sourceCode r"><span class="fu">find_block</span>()</code> to be able to return in which block a variable belongs to:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Returns the corresponding name of the block for a variable</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param name Variable name (string).</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>find_block <span class="ot">&lt;-</span> <span class="cf">function</span>(name) {</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  variables_types[variables_types[, <span class="dv">1</span>] <span class="sc">==</span> name, <span class="dv">2</span>]</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">find_block</span>(<span class="st">"wy_obs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "world"</code></pre>
</div>
</div>
<p>We create a matrix with the constraints on coefficients to ensure the exogeneity of blocks: <span id="eq-restriction-matrix"><span class="math display">\[
\begin{bmatrix}
    A_{l}^{11} &amp; \colorbox{wongGold!17}{\textbf{\textcolor{wongGold}{$0$}}} &amp; \colorbox{wongGold!17}{\textbf{\textcolor{wongGold}{$0$}}}\\
    \colorbox{wongGold!17}{\textbf{\textcolor{wongGold}{$0$}}} &amp; A_{l}^{22} &amp; \colorbox{wongGold!17}{\textbf{\textcolor{wongGold}{$0$}}}\\
    A_{l}^{31} &amp; A_{l}^{32} &amp; A_{l}^{33}%
\end{bmatrix}
\tag{8.2}\]</span></span></p>
<p>The equations will be written in columns in this matrix. Hence, at element <span class="math inline">\([i,j]\)</span>, the coefficient indicates whether the j<span class="math inline">\(^\text{th}\)</span> variable can affect the i<span class="math inline">\(^\text{th}\)</span> one. If so, the element <span class="math inline">\([i,j]\)</span> will take the value 1; 0 otherwise.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>A_l_restrictions <span class="ot">&lt;-</span> </span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">ncol =</span> N, <span class="at">nrow =</span> N)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(A_l_restrictions) <span class="ot">&lt;-</span> <span class="fu">rownames</span>(A_l_restrictions) <span class="ot">&lt;-</span> variables_exo</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="co"># i_column &lt;- 1 ; i_row &lt;- 2</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i_column <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(A_l_restrictions)) {</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  name_eq <span class="ot">&lt;-</span> <span class="fu">colnames</span>(A_l_restrictions)[i_column]</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i_row <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(A_l_restrictions)) {</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    nom_expl <span class="ot">&lt;-</span> <span class="fu">rownames</span>(A_l_restrictions)[i_row]</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    value_to_set <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Climate block</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">find_block</span>(name_eq) <span class="sc">==</span> <span class="st">"climate"</span>) {</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">find_block</span>(nom_expl) <span class="sc">!=</span> <span class="st">"climate"</span>) value_to_set <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Rest of the world block</span></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">find_block</span>(name_eq) <span class="sc">==</span> <span class="st">"world"</span>) {</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">find_block</span>(nom_expl) <span class="sc">!=</span> <span class="st">"world"</span>) value_to_set <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    A_l_restrictions[i_row, i_column] <span class="ot">&lt;-</span> value_to_set</span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a><span class="co"># The equations by rows:</span></span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>A_l_restrictions <span class="ot">&lt;-</span> <span class="fu">t</span>(A_l_restrictions)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>A_l_restrictions</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         smdi_obs wy_obs y_obs y_a_obs h_obs c_obs i_obs reer_obs
smdi_obs        1      0     0       0     0     0     0        0
wy_obs          0      1     0       0     0     0     0        0
y_obs           1      1     1       1     1     1     1        1
y_a_obs         1      1     1       1     1     1     1        1
h_obs           1      1     1       1     1     1     1        1
c_obs           1      1     1       1     1     1     1        1
i_obs           1      1     1       1     1     1     1        1
reer_obs        1      1     1       1     1     1     1        1</code></pre>
</div>
</div>
<p>Depending on the number of desired lags, this matrix needs to be replicated so that all the constraints imposed apply to each lag. Again, equations are written in rows.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>A_l_restrict <span class="ot">&lt;-</span> <span class="fu">parse</span>(</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="fu">str_c</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"cbind("</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">str_c</span>(<span class="fu">rep</span>(<span class="st">"A_l_restrictions"</span>, L), <span class="at">collapse =</span> <span class="st">", "</span>),</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">")"</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">eval</span>()</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>A_l_restrict <span class="ot">&lt;-</span> <span class="fu">do.call</span>(cbind, <span class="fu">rep</span>(<span class="fu">list</span>(A_l_restrictions), L))</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>base_nms <span class="ot">&lt;-</span> <span class="fu">colnames</span>(A_l_restrictions)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(A_l_restrict) <span class="ot">&lt;-</span> <span class="fu">paste0</span>(</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>  base_nms, <span class="st">"_"</span>, <span class="fu">rep</span>(<span class="fu">seq_len</span>(L), <span class="at">each =</span> <span class="fu">length</span>(base_nms))</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Let us add an intercept (const)</span></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>A_l_restrict <span class="ot">&lt;-</span> <span class="fu">cbind</span>(A_l_restrict, <span class="at">const =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(A_l_restrict)))</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>A_l_restrict</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         smdi_obs_1 wy_obs_1 y_obs_1 y_a_obs_1 h_obs_1 c_obs_1 i_obs_1
smdi_obs          1        0       0         0       0       0       0
wy_obs            0        1       0         0       0       0       0
y_obs             1        1       1         1       1       1       1
y_a_obs           1        1       1         1       1       1       1
h_obs             1        1       1         1       1       1       1
c_obs             1        1       1         1       1       1       1
i_obs             1        1       1         1       1       1       1
reer_obs          1        1       1         1       1       1       1
         reer_obs_1 const
smdi_obs          0     1
wy_obs            0     1
y_obs             1     1
y_a_obs           1     1
h_obs             1     1
c_obs             1     1
i_obs             1     1
reer_obs          1     1</code></pre>
</div>
</div>
</section>
<section id="load-data" class="level2" data-number="8.2">
<h2 data-number="8.2" class="anchored" data-anchor-id="load-data"><span class="header-section-number">8.2</span> Load Data</h2>
<p>Let us load the data obtained gathered in <a href="data-macro.html" class="quarto-xref">Chapter&nbsp;<span>6</span></a>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">'../data/df_finale_ebook.rda'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Total production is denoted <code>y_tot_obs</code> in the base we just loaded, let us change this to simply <code>y_obs</code>. Then, let us keep only the variables of interest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df_finale <span class="ot">&lt;-</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  df_finale <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">y_obs =</span> y_tot_obs) <span class="sc">|&gt;</span> </span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(YEARS, <span class="sc">!!</span>variables_exo)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>In <a href="data-macro.html" class="quarto-xref">Chapter&nbsp;<span>6</span></a>, we made sure that positive values of the Soil Moisture Deficit index depict droughts. In the impulse response functions, we will impulse positive standard deviation shocks. This ensures that a positive shock depicts an increase in dryness.</p>
</div>
</div>
<p>We know there is no missing values between different dates so, we can use <code class="sourceCode r"><span class="fu">na.omit</span>()</code> without risk. There is only one missing value for the reer.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df_finale <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(df_finale)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>It will be more convenient to cast the series into a time series object (of class <code>ts</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>start_date_raw_data <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  df_finale<span class="sc">$</span>YEARS[<span class="dv">1</span>] <span class="sc">%/%</span> <span class="dv">1</span>,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  df_finale<span class="sc">$</span>YEARS[<span class="dv">1</span>] <span class="sc">%%</span> <span class="dv">1</span> <span class="sc">*</span> <span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>end_date_raw_data <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  df_finale<span class="sc">$</span>YEARS[<span class="fu">nrow</span>(df_finale)] <span class="sc">%/%</span> <span class="dv">1</span>,</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  df_finale<span class="sc">$</span>YEARS[<span class="fu">nrow</span>(df_finale)] <span class="sc">%%</span> <span class="dv">1</span> <span class="sc">*</span> <span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>frequency_raw_data <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="co"># quarterly</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>start_date_sample <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>  df_finale<span class="sc">$</span>YEARS[<span class="dv">1</span>] <span class="sc">%/%</span> <span class="dv">1</span>,</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>  df_finale<span class="sc">$</span>YEARS[<span class="dv">1</span>] <span class="sc">%%</span> <span class="dv">1</span> <span class="sc">*</span> <span class="dv">4</span> <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>end_date_sample <span class="ot">&lt;-</span> end_date_raw_data</span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Turning it to a ts object</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>raw_data <span class="ot">&lt;-</span> </span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>  df_finale <span class="sc">|&gt;</span> </span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!!</span>variables_exo) <span class="sc">|&gt;</span> </span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ts</span>(<span class="at">frequency =</span> frequency_raw_data, <span class="at">start =</span> start_date_raw_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let us call the data used in the estimation <code>"data"</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> raw_data</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            smdi_obs      wy_obs       y_obs     y_a_obs       h_obs
smdi_obs  1.00000000  0.19606076 -0.19660938 -0.11263581 -0.14052625
wy_obs    0.19606076  1.00000000  0.25998532  0.07661121  0.11983123
y_obs    -0.19660938  0.25998532  1.00000000  0.08190103  0.24652057
y_a_obs  -0.11263581  0.07661121  0.08190103  1.00000000 -0.03260390
h_obs    -0.14052625  0.11983123  0.24652057 -0.03260390  1.00000000
c_obs     0.07587367  0.28990378  0.28920644  0.49468434 -0.07365197
i_obs    -0.12784838  0.54658438  0.70161881  0.17183983  0.29588680
reer_obs -0.12222779 -0.33922581  0.09042631 -0.12259028  0.07331378
               c_obs      i_obs    reer_obs
smdi_obs  0.07587367 -0.1278484 -0.12222779
wy_obs    0.28990378  0.5465844 -0.33922581
y_obs     0.28920644  0.7016188  0.09042631
y_a_obs   0.49468434  0.1718398 -0.12259028
h_obs    -0.07365197  0.2958868  0.07331378
c_obs     1.00000000  0.2634593 -0.07931696
i_obs     0.26345930  1.0000000 -0.14470007
reer_obs -0.07931696 -0.1447001  1.00000000</code></pre>
</div>
</div>
</section>
<section id="estimation" class="level2" data-number="8.3">
<h2 data-number="8.3" class="anchored" data-anchor-id="estimation"><span class="header-section-number">8.3</span> Estimation</h2>
<p>We will use the functions from {vars} to estimate the VAR (note that it masks the function <code>select()</code> from {dplyr}, which leads us to use <code>dplyr::select()</code> afterwards, if needed).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(vars)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: MASS</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'MASS'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    select</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: strucchange</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: zoo</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'zoo'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    as.Date, as.Date.numeric</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: sandwich</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'strucchange'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:stringr':

    boundary</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: urca</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: lmtest</code></pre>
</div>
</div>
<p>The function <code class="sourceCode r"><span class="fu">VARselect</span>()</code> estimates infomation criteria and final prediction error for sequential increasing the lag order up to a VAR(p)-proccess.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">VARselect</span>(data, <span class="at">lag.max =</span> <span class="dv">4</span>, <span class="at">type =</span> <span class="st">"const"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$selection
AIC(n)  HQ(n)  SC(n) FPE(n) 
     2      1      1      2 

$criteria
                1         2          3          4
AIC(n)   4.730414  4.486327   4.559102   4.731252
HQ(n)    5.557377  6.048368   6.856220   7.763449
SC(n)    6.785217  8.367621  10.266886  12.265528
FPE(n) 114.042079 92.621039 109.638606 157.964462</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If the number of lags that produces the best fit with respect to the criterion you want to use is different from 1, set the value to <code>L</code> to the desired value in <a href="#sec-var-settions" class="quarto-xref"><span>Section 8.1</span></a>, and run the above codes again.</p>
</div>
</div>
<section id="sec-restricted-var" class="level3" data-number="8.3.1">
<h3 data-number="8.3.1" class="anchored" data-anchor-id="sec-restricted-var"><span class="header-section-number">8.3.1</span> Restricted VAR</h3>
<p>We first need to estimate the VAR without constraints, i.e., without imposing <span class="math inline">\(0\)</span> coefficients in the matrix shown in <a href="#eq-restriction-matrix" class="quarto-xref">Equation&nbsp;<span>8.2</span></a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>var_1 <span class="ot">&lt;-</span> <span class="fu">VAR</span>(data, <span class="at">p =</span> L, <span class="at">type =</span> <span class="st">"const"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The restrictions can be added to estimate the model shown in <a href="#eq-VAR" class="quarto-xref">Equation&nbsp;<span>8.1</span></a>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>var_res <span class="ot">&lt;-</span> <span class="fu">restrict</span>(var_1, <span class="at">method =</span> <span class="st">"manual"</span>, <span class="at">resmat =</span> A_l_restrict)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="sec-svar" class="level3" data-number="8.3.2">
<h3 data-number="8.3.2" class="anchored" data-anchor-id="sec-svar"><span class="header-section-number">8.3.2</span> Structural VAR</h3>
<p>We further need to impose structure on the contemporaneous relationships amont variables. We estimate a Structural VAR (SVAR) model to do so: <span id="eq-svar"><span class="math display">\[
\begin{equation*}
    \colorbox{wongGreen!17}{\textbf{\textcolor{wongGreen}{$A_{0}$}}} X_{t} = C + \sum_{l=1}^{p} A_{l} X_{t-l} + \colorbox{wongGold!17}{\textbf{\textcolor{wongGold}{$\eta_{t}$}}},
\end{equation*}
\tag{8.3}\]</span></span></p>
<p>The matrix <span class="math inline">\(\textcolor{wongGreen}{A_0}\)</span> is a lower triangular matrix which encodes the <span id="highlight-green">contemporaneous restrictions</span>, and <span class="math inline">\(\textcolor{wongGold}{\eta_{t}}\)</span> are the <span id="highlight-gold">orthogonal structural shocks</span>. It ensures the contemporaneous exogeneity of the weather and of foreign variables. Those variables do not react within the quarter to domestic shocks, while domestic variables may react instantly to them. The order of the variables matters. Variables ordered earlier can contemporaneously affect variables ordered later, but not the other way around. In addition, we put 1s on the diagonal to fix the scale of each equation so that the shocks <span class="math inline">\(\eta_t\)</span> are structural shocks, i.e., orthogonal and scaled, which is required to compute the IRFs.</p>
<p>The SVAR model can be estimate, by specifying the <span class="math inline">\(A_0\)</span> matrix. Each row of this matrix sets the constraints for an equation of the previously estimated VAR. <span id="eq-azero"><span class="math display">\[
\begin{equation*}
  {\color{wongGreen}A_{0}}=
  \begin{bmatrix}
  1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
  0 &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
  b_{31} &amp; b_{32} &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
  b_{41} &amp; b_{42} &amp; b_{43} &amp; 1 &amp; 0 &amp; 0 &amp; 0 &amp; 0\\
  b_{51} &amp; b_{52} &amp; b_{53} &amp; b_{54} &amp; 1 &amp; 0 &amp; 0 &amp; 0\\
  b_{61} &amp; b_{62} &amp; b_{63} &amp; b_{64} &amp; b_{65} &amp; 1 &amp; 0 &amp; 0\\
  b_{71} &amp; b_{72} &amp; b_{73} &amp; b_{74} &amp; b_{75} &amp; b_{76} &amp; 1 &amp; 0\\
  b_{81} &amp; b_{82} &amp; b_{83} &amp; b_{84} &amp; b_{85} &amp; b_{86} &amp; b_{87} &amp; 1
  \end{bmatrix}
\end{equation*}
\tag{8.4}\]</span></span></p>
<p>For example, the 4th row (row for <code>y_a_obs</code>) states that the agricultural output can contemporaneously depend only on the weather (first column), foreign GDP (second column) and domestic output (third column).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>amat <span class="ot">&lt;-</span> A_l_restrictions</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>amat[amat <span class="sc">==</span> <span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>amat[<span class="fu">upper.tri</span>(amat)] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">diag</span>(amat) <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>amat</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         smdi_obs wy_obs y_obs y_a_obs h_obs c_obs i_obs reer_obs
smdi_obs        1      0     0       0     0     0     0        0
wy_obs          0      1     0       0     0     0     0        0
y_obs          NA     NA     1       0     0     0     0        0
y_a_obs        NA     NA    NA       1     0     0     0        0
h_obs          NA     NA    NA      NA     1     0     0        0
c_obs          NA     NA    NA      NA    NA     1     0        0
i_obs          NA     NA    NA      NA    NA    NA     1        0
reer_obs       NA     NA    NA      NA    NA    NA    NA        1</code></pre>
</div>
</div>
: we enforce weather/foreign as exogenous blocks in the lag structure.
:
: \begin{itemize}
<p>to have 1 s.d. structural shock in the IRFs</p>
<p>The estimation of the SVAR:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>svar_est <span class="ot">&lt;-</span> <span class="fu">SVAR</span>(<span class="at">x =</span> var_res, <span class="at">Amat =</span> amat, <span class="at">Bmat =</span> <span class="cn">NULL</span>, <span class="at">estmethod =</span> <span class="st">"direct"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Estimation Results
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The estimation results:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(svar_est)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
SVAR Estimation Results:
======================== 

Call:
SVAR(x = var_res, estmethod = "direct", Amat = amat, Bmat = NULL)

Type: A-model 
Sample size: 89 
Log Likelihood: -1010.284 
Method: direct 
Number of iterations: 502 
Convergence code: 1 

LR overidentification test:

    LR overidentification

data:  data
Chi^2 = -316, df = 9, p-value = 1


Estimated A matrix:
         smdi_obs  wy_obs   y_obs  y_a_obs  h_obs  c_obs i_obs reer_obs
smdi_obs  1.00000 0.00000 0.00000  0.00000 0.0000 0.0000 0.000        0
wy_obs    0.00000 1.00000 0.00000  0.00000 0.0000 0.0000 0.000        0
y_obs     0.06329 0.20378 1.00000  0.00000 0.0000 0.0000 0.000        0
y_a_obs   0.10282 0.14097 0.11542  1.00000 0.0000 0.0000 0.000        0
h_obs     0.17090 0.06810 0.10482  0.09727 1.0000 0.0000 0.000        0
c_obs     0.12516 0.12901 0.11598  0.09116 0.1129 1.0000 0.000        0
i_obs     0.13012 0.11064 0.01358 -0.13792 0.1071 0.1097 1.000        0
reer_obs  0.12177 0.08929 0.09664  0.11193 0.1280 0.0870 0.102        1

Estimated B matrix:
         smdi_obs wy_obs y_obs y_a_obs h_obs c_obs i_obs reer_obs
smdi_obs        1      0     0       0     0     0     0        0
wy_obs          0      1     0       0     0     0     0        0
y_obs           0      0     1       0     0     0     0        0
y_a_obs         0      0     0       1     0     0     0        0
h_obs           0      0     0       0     1     0     0        0
c_obs           0      0     0       0     0     1     0        0
i_obs           0      0     0       0     0     0     1        0
reer_obs        0      0     0       0     0     0     0        1

Covariance matrix of reduced form residuals (*100):
         smdi_obs  wy_obs   y_obs y_a_obs   h_obs   c_obs   i_obs reer_obs
smdi_obs  100.000   0.000  -6.329  -9.551 -15.498  -9.161 -11.578   -6.535
wy_obs      0.000 100.000 -20.378 -11.745  -3.532  -9.068 -11.034   -3.279
y_obs      -6.329 -20.378 104.553  -8.544  -7.659  -7.061   2.075   -5.174
y_a_obs    -9.551 -11.745  -8.544 103.624  -6.752  -4.982  18.220   -9.122
h_obs     -15.498  -3.532  -7.659  -6.752 104.349  -7.886  -8.732   -8.078
c_obs      -9.161  -9.068  -7.061  -4.982  -7.886 104.480  -9.013   -3.996
i_obs     -11.578 -11.034   2.075  18.220  -8.732  -9.013 107.136   -8.871
reer_obs   -6.535  -3.279  -5.174  -9.122  -8.078  -3.996  -8.871  104.896</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The data can be exported for use in the DSGE</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_delim</span>(df_finale, <span class="at">file =</span> <span class="st">"../data/df_finale_var_ebook.csv"</span>, <span class="at">delim =</span> <span class="st">";"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can have a look at the observed weather series and the fitted one:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="fu">tibble</span>(</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">time =</span> zoo<span class="sc">::</span><span class="fu">as.Date</span>(<span class="fu">time</span>(var_res<span class="sc">$</span>y))[<span class="sc">-</span>(<span class="dv">1</span><span class="sc">:</span> var_res<span class="sc">$</span>p)],</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">obs =</span>  var_res<span class="sc">$</span>datamat<span class="sc">$</span>smdi_obs,</span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">fitted =</span> <span class="fu">fitted</span>(var_res<span class="sc">$</span>varresult<span class="sc">$</span>smdi_obs)</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>time, <span class="at">names_to =</span> <span class="st">"type"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">type =</span> <span class="fu">factor</span>(type, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"obs"</span>, <span class="st">"fitted"</span>))),</span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> value, <span class="at">colour =</span> type)</span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(</span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"obs"</span> <span class="ot">=</span> <span class="st">"black"</span>, <span class="st">"fitted"</span> <span class="ot">=</span> <span class="st">"blue"</span>)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="var-estimation_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="fisher-test" class="level3" data-number="8.3.3">
<h3 data-number="8.3.3" class="anchored" data-anchor-id="fisher-test"><span class="header-section-number">8.3.3</span> Fisher Test</h3>
<p>We use a nested-model F-test to assess whether the weather variable (<code>smdi_obs</code>) improves fit for each target variable (output, agri output, hours, consumption, investment, REER).</p>
<p>To do so, we define a function, <code class="sourceCode r"><span class="fu">fisher_test</span>()</code>, that builds two linear regressions:</p>
<ol type="1">
<li>A complete model, which includes the target’s admissible contemporaneous regressors (from the SVAR <span class="math inline">\(\color{wongGreen}A_0\)</span> pattern in <code>amat</code>, if <code>contemp = TRUE</code>) and admissible lagged regressors (from the VAR mask <code>A_l_restrict</code>).</li>
</ol>
<ul>
<li>A restricted model, with the same specification, but with <code>smdi_obs</code> removed (both its contemporaneous and/or lag terms, depending on the setting).</li>
</ul>
<p>It then compares the residual sums of squares (RSS) to form <span id="eq-f-test"><span class="math display">\[
F = \frac{(\text{RSS}_R - \text{RSS}_C)/k}{\text{RSS}_C/(n - p - k)},
\tag{8.5}\]</span></span> where <span class="math inline">\(k\)</span> is the number of coefficients dropped and <span class="math inline">\(p\)</span> the number in the restricted model. A small p-value indicates that weather adds information.</p>
<div class="cell">
<details class="code-fold">
<summary>The <code class="sourceCode r"><span class="fu">fisher_test</span>()</code> function.</summary>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Fisher Test for the Inclusion of the Weather Variable</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @description</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' Performs a nested-model Fisher test to evaluate whether including the weather</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' variable (`smdi_obs`) improves the fit of an equation in the restricted </span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' VAR/SVAR system.</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' The function compares a complete model (including all admissible </span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' contemporaneous and lagged regressors) to a restricted model where the </span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' weather variable (and optionally its lags) is removed.</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param variables_rest Character vector of variables included in the baseline</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co">#'  (restricted) model. Include the weather variable `"smdi_obs"` and possibly </span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="co">#'  other variables.</span></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param variables_interest Character string giving the dependent variable </span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co">#'  to test.</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param print_res If `TRUE` (default), the equations of the models and the</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="co">#'  summary of the results are printed in the console.</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param contemp If `TRUE` (default), for the target equation (row in `amat`), </span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="co">#'  any entry that is `NA` (i.e., free to estimate) is included; zeros are</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a><span class="co">#'  excluded. If `FALSE`, only lagged effects are considered.</span></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a><span class="co">#'  </span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="co">#' @details</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a><span class="co">#' The admissible regressors are determined from the restriction matrices:</span></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="co">#' * The contemporaneous matrix `amat` (from the SVAR): if a coefficient</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a><span class="co">#'   is `NA` in the row corresponding to the dependent variable, the associated</span></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a><span class="co">#'   variable is included.</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a><span class="co">#' * The lag restriction matrix _A_l_restrict_ (from the restricted VAR):</span></span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a><span class="co">#'   if the entry equals `1` in that row, the corresponding lagged variable</span></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a><span class="co">#'   is included.</span></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a><span class="co">#' For each dependent variable, two linear models are estimated:</span></span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a><span class="co">#' * Complete model: includes all admissible contemporaneous and lagged </span></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a><span class="co">#'   regressors.</span></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a><span class="co">#' * Restricted model: same as the complete model but with the weather variable</span></span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a><span class="co">#'   (and its lags, if any) removed.</span></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a><span class="co">#'   </span></span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a><span class="co">#' The Fisher test statistic is computed as:</span></span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a><span class="co">#' \deqn{</span></span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a><span class="co">#' F = \frac{(RSS_R - RSS_C)/k}{RSS_C / (n - p - k)},</span></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a><span class="co">#' }</span></span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a><span class="co">#' where \eqn{RSS_R} and \eqn{RSS_C} are the residual sums of squares of the</span></span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a><span class="co">#' restricted and complete models, respectively; \eqn{k} is the number of</span></span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a><span class="co">#' restrictions, and \eqn{p} is the number of estimated parameters in the</span></span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a><span class="co">#' restricted model.</span></span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a><span class="co">#' @returns  A tibble with the following columns:</span></span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a><span class="co">#' * `var`: tested dependent variable,</span></span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a><span class="co">#' * `F`: computed F-statistic,</span></span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a><span class="co">#' * `Pr(&gt;F)`: associated p-value.</span></span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a><span class="co">#' </span></span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a>fisher_test <span class="ot">&lt;-</span> <span class="cf">function</span>(variables_rest, </span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true" tabindex="-1"></a>                        variables_interest, </span>
<span id="cb45-52"><a href="#cb45-52" aria-hidden="true" tabindex="-1"></a>                        <span class="at">print_res =</span> <span class="cn">TRUE</span>, </span>
<span id="cb45-53"><a href="#cb45-53" aria-hidden="true" tabindex="-1"></a>                        <span class="at">contemp =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb45-54"><a href="#cb45-54" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-55"><a href="#cb45-55" aria-hidden="true" tabindex="-1"></a>  variables <span class="ot">&lt;-</span> <span class="fu">c</span>(variables_rest, variables_interest)</span>
<span id="cb45-56"><a href="#cb45-56" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-57"><a href="#cb45-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Complete model</span></span>
<span id="cb45-58"><a href="#cb45-58" aria-hidden="true" tabindex="-1"></a>  data_tmp <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(data)</span>
<span id="cb45-59"><a href="#cb45-59" aria-hidden="true" tabindex="-1"></a>  data_tmp <span class="ot">&lt;-</span> </span>
<span id="cb45-60"><a href="#cb45-60" aria-hidden="true" tabindex="-1"></a>    data_tmp <span class="sc">|&gt;</span> </span>
<span id="cb45-61"><a href="#cb45-61" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!!</span>variables)</span>
<span id="cb45-62"><a href="#cb45-62" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-63"><a href="#cb45-63" aria-hidden="true" tabindex="-1"></a>  form <span class="ot">&lt;-</span> <span class="fu">str_c</span>(variables_interest, <span class="st">" ~ 1"</span>)</span>
<span id="cb45-64"><a href="#cb45-64" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-65"><a href="#cb45-65" aria-hidden="true" tabindex="-1"></a>  <span class="co"># i &lt;- 1</span></span>
<span id="cb45-66"><a href="#cb45-66" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(variables)) {</span>
<span id="cb45-67"><a href="#cb45-67" aria-hidden="true" tabindex="-1"></a>    var_name <span class="ot">&lt;-</span> variables[i]</span>
<span id="cb45-68"><a href="#cb45-68" aria-hidden="true" tabindex="-1"></a>    var_name_new <span class="ot">&lt;-</span> <span class="fu">str_c</span>(variables[i], <span class="st">"_1"</span>)</span>
<span id="cb45-69"><a href="#cb45-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-70"><a href="#cb45-70" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Contemporaneous effect</span></span>
<span id="cb45-71"><a href="#cb45-71" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (contemp) {</span>
<span id="cb45-72"><a href="#cb45-72" aria-hidden="true" tabindex="-1"></a>      ind <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">rownames</span>(amat) <span class="sc">==</span> variables_interest)</span>
<span id="cb45-73"><a href="#cb45-73" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.na</span>(amat[ind, <span class="fu">which</span>(<span class="fu">colnames</span>(amat) <span class="sc">==</span> var_name)])) {</span>
<span id="cb45-74"><a href="#cb45-74" aria-hidden="true" tabindex="-1"></a>        form <span class="ot">&lt;-</span> <span class="fu">str_c</span>(form, var_name, <span class="at">sep =</span> <span class="st">" + "</span>)</span>
<span id="cb45-75"><a href="#cb45-75" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb45-76"><a href="#cb45-76" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb45-77"><a href="#cb45-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-78"><a href="#cb45-78" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lagged effect</span></span>
<span id="cb45-79"><a href="#cb45-79" aria-hidden="true" tabindex="-1"></a>    ind <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">rownames</span>(A_l_restrict) <span class="sc">==</span> variables_interest)</span>
<span id="cb45-80"><a href="#cb45-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-81"><a href="#cb45-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (A_l_restrict[ind, <span class="fu">which</span>(<span class="fu">colnames</span>(A_l_restrict) <span class="sc">==</span> var_name_new)] <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb45-82"><a href="#cb45-82" aria-hidden="true" tabindex="-1"></a>      data_tmp <span class="ot">&lt;-</span> </span>
<span id="cb45-83"><a href="#cb45-83" aria-hidden="true" tabindex="-1"></a>        data_tmp <span class="sc">|&gt;</span> </span>
<span id="cb45-84"><a href="#cb45-84" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="sc">!!</span><span class="at">var_name_new :=</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(<span class="sc">!!</span><span class="fu">sym</span>(var_name),<span class="dv">1</span>))</span>
<span id="cb45-85"><a href="#cb45-85" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb45-86"><a href="#cb45-86" aria-hidden="true" tabindex="-1"></a>      form <span class="ot">&lt;-</span> <span class="fu">str_c</span>(form, var_name_new, <span class="at">sep =</span> <span class="st">" + "</span>)</span>
<span id="cb45-87"><a href="#cb45-87" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb45-88"><a href="#cb45-88" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-89"><a href="#cb45-89" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-90"><a href="#cb45-90" aria-hidden="true" tabindex="-1"></a>  mod_complete <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">as.formula</span>(form), <span class="at">data =</span> data_tmp)</span>
<span id="cb45-91"><a href="#cb45-91" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-92"><a href="#cb45-92" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Restricted model</span></span>
<span id="cb45-93"><a href="#cb45-93" aria-hidden="true" tabindex="-1"></a>  variables_rest_r <span class="ot">&lt;-</span> variables_rest[<span class="sc">-</span><span class="fu">which</span>(variables_rest <span class="sc">==</span> <span class="st">"smdi_obs"</span>)]</span>
<span id="cb45-94"><a href="#cb45-94" aria-hidden="true" tabindex="-1"></a>  variables_r <span class="ot">&lt;-</span> <span class="fu">c</span>(variables_rest_r, variables_interest)</span>
<span id="cb45-95"><a href="#cb45-95" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-96"><a href="#cb45-96" aria-hidden="true" tabindex="-1"></a>  data_tmp_r <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(data) <span class="sc">|&gt;</span> </span>
<span id="cb45-97"><a href="#cb45-97" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="sc">!!</span>variables_rest_r, <span class="sc">!!</span>variables_interest))</span>
<span id="cb45-98"><a href="#cb45-98" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-99"><a href="#cb45-99" aria-hidden="true" tabindex="-1"></a>  form_r <span class="ot">&lt;-</span> <span class="fu">str_c</span>(variables_interest, <span class="st">" ~ 1"</span>)</span>
<span id="cb45-100"><a href="#cb45-100" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-101"><a href="#cb45-101" aria-hidden="true" tabindex="-1"></a>  <span class="co"># i &lt;- 1</span></span>
<span id="cb45-102"><a href="#cb45-102" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(variables_r)) {</span>
<span id="cb45-103"><a href="#cb45-103" aria-hidden="true" tabindex="-1"></a>    var_name <span class="ot">&lt;-</span> variables_r[i]</span>
<span id="cb45-104"><a href="#cb45-104" aria-hidden="true" tabindex="-1"></a>    var_name_new <span class="ot">&lt;-</span> <span class="fu">str_c</span>(variables_r[i], <span class="st">"_1"</span>)</span>
<span id="cb45-105"><a href="#cb45-105" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-106"><a href="#cb45-106" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Contemporaneous effect</span></span>
<span id="cb45-107"><a href="#cb45-107" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (contemp) {</span>
<span id="cb45-108"><a href="#cb45-108" aria-hidden="true" tabindex="-1"></a>      ind <span class="ot">&lt;-</span> <span class="fu">which</span>(<span class="fu">rownames</span>(amat) <span class="sc">==</span> variables_interest)</span>
<span id="cb45-109"><a href="#cb45-109" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">is.na</span>(amat[ind, <span class="fu">which</span>(<span class="fu">colnames</span>(amat) <span class="sc">==</span> var_name)])) {</span>
<span id="cb45-110"><a href="#cb45-110" aria-hidden="true" tabindex="-1"></a>        form_r <span class="ot">&lt;-</span> <span class="fu">str_c</span>(form_r, var_name, <span class="at">sep =</span> <span class="st">" + "</span>)</span>
<span id="cb45-111"><a href="#cb45-111" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb45-112"><a href="#cb45-112" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb45-113"><a href="#cb45-113" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-114"><a href="#cb45-114" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Lagged effect</span></span>
<span id="cb45-115"><a href="#cb45-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (A_l_restrict[ind, <span class="fu">which</span>(<span class="fu">colnames</span>(A_l_restrict) <span class="sc">==</span> var_name_new)] <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb45-116"><a href="#cb45-116" aria-hidden="true" tabindex="-1"></a>      data_tmp_r <span class="ot">&lt;-</span> </span>
<span id="cb45-117"><a href="#cb45-117" aria-hidden="true" tabindex="-1"></a>        data_tmp_r <span class="sc">|&gt;</span> </span>
<span id="cb45-118"><a href="#cb45-118" aria-hidden="true" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="sc">!!</span><span class="at">var_name_new :=</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(<span class="sc">!!</span><span class="fu">sym</span>(var_name),<span class="dv">1</span>))</span>
<span id="cb45-119"><a href="#cb45-119" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb45-120"><a href="#cb45-120" aria-hidden="true" tabindex="-1"></a>      form_r <span class="ot">&lt;-</span> <span class="fu">str_c</span>(form_r, var_name_new, <span class="at">sep =</span> <span class="st">" + "</span>)</span>
<span id="cb45-121"><a href="#cb45-121" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb45-122"><a href="#cb45-122" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-123"><a href="#cb45-123" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-124"><a href="#cb45-124" aria-hidden="true" tabindex="-1"></a>  mod_restricted <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">as.formula</span>(form_r), <span class="at">data =</span> data_tmp_r)</span>
<span id="cb45-125"><a href="#cb45-125" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-126"><a href="#cb45-126" aria-hidden="true" tabindex="-1"></a>  rss_r <span class="ot">&lt;-</span> <span class="fu">sum</span>(mod_restricted<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb45-127"><a href="#cb45-127" aria-hidden="true" tabindex="-1"></a>  rss_c <span class="ot">&lt;-</span> <span class="fu">sum</span>(mod_complete<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb45-128"><a href="#cb45-128" aria-hidden="true" tabindex="-1"></a>  const <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb45-129"><a href="#cb45-129" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> mod_restricted<span class="sc">$</span>rank<span class="sc">-</span>const</span>
<span id="cb45-130"><a href="#cb45-130" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> mod_complete<span class="sc">$</span>rank <span class="sc">-</span> const <span class="sc">-</span> p</span>
<span id="cb45-131"><a href="#cb45-131" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(mod_restricted<span class="sc">$</span>residuals)</span>
<span id="cb45-132"><a href="#cb45-132" aria-hidden="true" tabindex="-1"></a>  F_obs <span class="ot">&lt;-</span> ((rss_r <span class="sc">-</span> rss_c) <span class="sc">/</span> k) <span class="sc">/</span> (rss_c <span class="sc">/</span> (n <span class="sc">-</span> (k<span class="sc">+</span>p<span class="sc">+</span>const)))</span>
<span id="cb45-133"><a href="#cb45-133" aria-hidden="true" tabindex="-1"></a>  (F_tab <span class="ot">&lt;-</span> <span class="fu">qf</span>(<span class="at">p =</span> <span class="dv">1</span><span class="fl">-0.05</span>, <span class="at">df1 =</span> p, <span class="at">df2 =</span> n <span class="sc">-</span> (k<span class="sc">+</span>p<span class="sc">+</span><span class="dv">1</span>)))</span>
<span id="cb45-134"><a href="#cb45-134" aria-hidden="true" tabindex="-1"></a>  p_value <span class="ot">&lt;-</span> (<span class="dv">1</span> <span class="sc">-</span> <span class="fu">pf</span>(<span class="at">q =</span> F_obs, <span class="at">df1 =</span> p, <span class="at">df2 =</span> n <span class="sc">-</span> (k<span class="sc">+</span>p<span class="sc">+</span>const)))</span>
<span id="cb45-135"><a href="#cb45-135" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-136"><a href="#cb45-136" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"Complete model:</span><span class="sc">\n</span><span class="st">---------------</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb45-137"><a href="#cb45-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(form)</span>
<span id="cb45-138"><a href="#cb45-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n\n</span><span class="st">Restricted model:</span><span class="sc">\n</span><span class="st">---------------</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb45-139"><a href="#cb45-139" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(form_r)</span>
<span id="cb45-140"><a href="#cb45-140" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb45-141"><a href="#cb45-141" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(print_res)</span>
<span id="cb45-142"><a href="#cb45-142" aria-hidden="true" tabindex="-1"></a>    texreg<span class="sc">::</span><span class="fu">screenreg</span>(</span>
<span id="cb45-143"><a href="#cb45-143" aria-hidden="true" tabindex="-1"></a>      <span class="at">l =</span> <span class="fu">list</span>(mod_complete, mod_restricted),</span>
<span id="cb45-144"><a href="#cb45-144" aria-hidden="true" tabindex="-1"></a>      <span class="at">custom.model.names =</span> <span class="fu">c</span>(<span class="st">"Complete"</span>, <span class="st">"Restricted"</span>)</span>
<span id="cb45-145"><a href="#cb45-145" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span> </span>
<span id="cb45-146"><a href="#cb45-146" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>()</span>
<span id="cb45-147"><a href="#cb45-147" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb45-148"><a href="#cb45-148" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">var =</span> <span class="sc">!!</span>variables_interest, <span class="at">F =</span> F_obs, <span class="st">`</span><span class="at">Pr(&gt;F)</span><span class="st">`</span> <span class="ot">=</span> p_value)</span>
<span id="cb45-149"><a href="#cb45-149" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We consider three testing setups:</p>
<ol type="1">
<li>Bivariate, past + current: we test whether weather (contemporaneous and its lags, as allowed) improves a bivariate regression (target on itself and weather).</li>
<li>Multivariate, past only: we test whether lagged weather adds predictive power beyond the full set of other lagged variables.</li>
<li>Multivariate, past + current: we test whether both contemporaneous and lagged weather terms improve fit in the SVAR-consistent equation.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>variables_rest <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"smdi_obs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Bivariate, past + current
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>f_test <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"y_obs"</span>, <span class="st">"y_a_obs"</span>, <span class="st">"h_obs"</span>, <span class="st">"c_obs"</span>, <span class="st">"i_obs"</span>, <span class="st">"reer_obs"</span>)) {</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>  f_test_tmp <span class="ot">&lt;-</span> <span class="fu">fisher_test</span>(</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">variables_rest =</span> variables_rest,</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">variables_interest =</span> v, <span class="at">print_res =</span> F</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  f_test <span class="ot">&lt;-</span> f_test <span class="sc">|&gt;</span> </span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_rows</span>(f_test_tmp)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete model:
---------------
y_obs ~ 1 + smdi_obs + smdi_obs_1 + y_obs_1

Restricted model:
---------------
y_obs ~ 1 + y_obs_1
Complete model:
---------------
y_a_obs ~ 1 + smdi_obs + smdi_obs_1 + y_a_obs_1

Restricted model:
---------------
y_a_obs ~ 1 + y_a_obs_1
Complete model:
---------------
h_obs ~ 1 + smdi_obs + smdi_obs_1 + h_obs_1

Restricted model:
---------------
h_obs ~ 1 + h_obs_1
Complete model:
---------------
c_obs ~ 1 + smdi_obs + smdi_obs_1 + c_obs_1

Restricted model:
---------------
c_obs ~ 1 + c_obs_1
Complete model:
---------------
i_obs ~ 1 + smdi_obs + smdi_obs_1 + i_obs_1

Restricted model:
---------------
i_obs ~ 1 + i_obs_1
Complete model:
---------------
reer_obs ~ 1 + smdi_obs + smdi_obs_1 + reer_obs_1

Restricted model:
---------------
reer_obs ~ 1 + reer_obs_1</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Multivariate, past only
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>variables_rest <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"smdi_obs"</span>, <span class="st">"wy_obs"</span>, <span class="st">"y_obs"</span>, <span class="st">"y_a_obs"</span>, <span class="st">"h_obs"</span>, <span class="st">"c_obs"</span>, <span class="st">"i_obs"</span>, <span class="st">"reer_obs"</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>f_test_2 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"y_obs"</span>, <span class="st">"y_a_obs"</span>, <span class="st">"h_obs"</span>, <span class="st">"c_obs"</span>, <span class="st">"i_obs"</span>, <span class="st">"reer_obs"</span>)) {</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>  f_test_tmp <span class="ot">&lt;-</span> <span class="fu">fisher_test</span>(</span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">variables_rest =</span> variables_rest,</span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">variables_interest =</span> v, <span class="at">print_res =</span> F, <span class="at">contemp =</span> F</span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a>  f_test_2 <span class="ot">&lt;-</span> f_test_2 <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>(f_test_tmp)</span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete model:
---------------
y_obs ~ 1 + smdi_obs_1 + wy_obs_1 + y_obs_1 + y_a_obs_1 + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + y_obs_1

Restricted model:
---------------
y_obs ~ 1 + wy_obs_1 + y_obs_1 + y_a_obs_1 + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + y_obs_1
Complete model:
---------------
y_a_obs ~ 1 + smdi_obs_1 + wy_obs_1 + y_obs_1 + y_a_obs_1 + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + y_a_obs_1

Restricted model:
---------------
y_a_obs ~ 1 + wy_obs_1 + y_obs_1 + y_a_obs_1 + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + y_a_obs_1
Complete model:
---------------
h_obs ~ 1 + smdi_obs_1 + wy_obs_1 + y_obs_1 + y_a_obs_1 + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + h_obs_1

Restricted model:
---------------
h_obs ~ 1 + wy_obs_1 + y_obs_1 + y_a_obs_1 + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + h_obs_1
Complete model:
---------------
c_obs ~ 1 + smdi_obs_1 + wy_obs_1 + y_obs_1 + y_a_obs_1 + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + c_obs_1

Restricted model:
---------------
c_obs ~ 1 + wy_obs_1 + y_obs_1 + y_a_obs_1 + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + c_obs_1
Complete model:
---------------
i_obs ~ 1 + smdi_obs_1 + wy_obs_1 + y_obs_1 + y_a_obs_1 + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + i_obs_1

Restricted model:
---------------
i_obs ~ 1 + wy_obs_1 + y_obs_1 + y_a_obs_1 + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + i_obs_1
Complete model:
---------------
reer_obs ~ 1 + smdi_obs_1 + wy_obs_1 + y_obs_1 + y_a_obs_1 + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + reer_obs_1

Restricted model:
---------------
reer_obs ~ 1 + wy_obs_1 + y_obs_1 + y_a_obs_1 + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + reer_obs_1</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Multivariate, past + current
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>variables_rest <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"smdi_obs"</span>, <span class="st">"wy_obs"</span>, <span class="st">"y_obs"</span>, <span class="st">"y_a_obs"</span>, <span class="st">"h_obs"</span>, <span class="st">"c_obs"</span>, <span class="st">"i_obs"</span>, <span class="st">"reer_obs"</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>f_test_3 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> <span class="fu">c</span>(<span class="st">"y_obs"</span>, <span class="st">"y_a_obs"</span>, <span class="st">"h_obs"</span>, <span class="st">"c_obs"</span>, <span class="st">"i_obs"</span>, <span class="st">"reer_obs"</span>)) {</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>  f_test_tmp <span class="ot">&lt;-</span> <span class="fu">fisher_test</span>(</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">variables_rest =</span> variables_rest,</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">variables_interest =</span> v, <span class="at">print_res =</span> F</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  f_test_3 <span class="ot">&lt;-</span> f_test_3 <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>(f_test_tmp)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Complete model:
---------------
y_obs ~ 1 + smdi_obs + smdi_obs_1 + wy_obs + wy_obs_1 + y_obs_1 + y_a_obs_1 + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + y_obs_1

Restricted model:
---------------
y_obs ~ 1 + wy_obs + wy_obs_1 + y_obs_1 + y_a_obs_1 + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + y_obs_1
Complete model:
---------------
y_a_obs ~ 1 + smdi_obs + smdi_obs_1 + wy_obs + wy_obs_1 + y_obs + y_obs_1 + y_a_obs_1 + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + y_a_obs_1

Restricted model:
---------------
y_a_obs ~ 1 + wy_obs + wy_obs_1 + y_obs + y_obs_1 + y_a_obs_1 + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + y_a_obs_1
Complete model:
---------------
h_obs ~ 1 + smdi_obs + smdi_obs_1 + wy_obs + wy_obs_1 + y_obs + y_obs_1 + y_a_obs + y_a_obs_1 + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + h_obs_1

Restricted model:
---------------
h_obs ~ 1 + wy_obs + wy_obs_1 + y_obs + y_obs_1 + y_a_obs + y_a_obs_1 + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + h_obs_1
Complete model:
---------------
c_obs ~ 1 + smdi_obs + smdi_obs_1 + wy_obs + wy_obs_1 + y_obs + y_obs_1 + y_a_obs + y_a_obs_1 + h_obs + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + c_obs_1

Restricted model:
---------------
c_obs ~ 1 + wy_obs + wy_obs_1 + y_obs + y_obs_1 + y_a_obs + y_a_obs_1 + h_obs + h_obs_1 + c_obs_1 + i_obs_1 + reer_obs_1 + c_obs_1
Complete model:
---------------
i_obs ~ 1 + smdi_obs + smdi_obs_1 + wy_obs + wy_obs_1 + y_obs + y_obs_1 + y_a_obs + y_a_obs_1 + h_obs + h_obs_1 + c_obs + c_obs_1 + i_obs_1 + reer_obs_1 + i_obs_1

Restricted model:
---------------
i_obs ~ 1 + wy_obs + wy_obs_1 + y_obs + y_obs_1 + y_a_obs + y_a_obs_1 + h_obs + h_obs_1 + c_obs + c_obs_1 + i_obs_1 + reer_obs_1 + i_obs_1
Complete model:
---------------
reer_obs ~ 1 + smdi_obs + smdi_obs_1 + wy_obs + wy_obs_1 + y_obs + y_obs_1 + y_a_obs + y_a_obs_1 + h_obs + h_obs_1 + c_obs + c_obs_1 + i_obs + i_obs_1 + reer_obs_1 + reer_obs_1

Restricted model:
---------------
reer_obs ~ 1 + wy_obs + wy_obs_1 + y_obs + y_obs_1 + y_a_obs + y_a_obs_1 + h_obs + h_obs_1 + c_obs + c_obs_1 + i_obs + i_obs_1 + reer_obs_1 + reer_obs_1</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The results:</p>
<div class="cell">
<details class="code-fold">
<summary>Codes to create the Table.</summary>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>f_test <span class="sc">|&gt;</span> </span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    f_test_2 <span class="sc">|&gt;</span> </span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">F_2 =</span> F, <span class="st">`</span><span class="at">Pr(&gt;F)_2</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Pr(&gt;F)</span><span class="st">`</span>), </span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"var"</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(</span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>    f_test_3 <span class="sc">|&gt;</span> </span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename</span>(<span class="at">F_3 =</span> F, <span class="st">`</span><span class="at">Pr(&gt;F)_3</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">Pr(&gt;F)</span><span class="st">`</span>), </span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">by =</span> <span class="st">"var"</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">|&gt;</span> </span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_paper</span>(<span class="st">"hover"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">add_header_above</span>(</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>      <span class="st">" "</span> <span class="ot">=</span> <span class="dv">1</span>, </span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">"bivariate</span><span class="sc">\n</span><span class="st"> past only "</span> <span class="ot">=</span> <span class="dv">2</span>, </span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>      <span class="st">"multivariate</span><span class="sc">\n</span><span class="st"> past only "</span> <span class="ot">=</span> <span class="dv">2</span>, </span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>      <span class="st">"multivariate</span><span class="sc">\n</span><span class="st"> past + current"</span> <span class="ot">=</span> <span class="dv">2</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div id="tbl-f-test-weather" class="cell quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-f-test-weather-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;8.1: Inclusion tests of the (lagged) weather variable (F-test for nested models).
</figcaption>
<div aria-describedby="tbl-f-test-weather-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<table class="lightable-paper lightable-hover do-not-create-environment cell caption-top table table-sm table-striped small" data-quarto-postprocess="true">
<colgroup>
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 14%">
</colgroup>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="text-align: left; empty-cells: hide;"></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="TRUE">
bivariate<br>
past only
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="TRUE">
multivariate<br>
past only
</div></th>
<th colspan="2" data-quarto-table-cell-role="th" style="text-align: center; padding-bottom: 0; padding-left: 3px; padding-right: 3px;"><div style="TRUE">
multivariate<br>
past + current
</div></th>
</tr>
<tr class="even">
<th style="text-align: left;" data-quarto-table-cell-role="th">var</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">F</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Pr(&gt;F)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">F_2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Pr(&gt;F)_2</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">F_3</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Pr(&gt;F)_3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">y_obs</td>
<td style="text-align: right;">2.86</td>
<td style="text-align: right;">0.06</td>
<td style="text-align: right;">3.34</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">2.53</td>
<td style="text-align: right;">0.01</td>
</tr>
<tr class="even">
<td style="text-align: left;">y_a_obs</td>
<td style="text-align: right;">2.57</td>
<td style="text-align: right;">0.08</td>
<td style="text-align: right;">6.38</td>
<td style="text-align: right;">0.00</td>
<td style="text-align: right;">3.22</td>
<td style="text-align: right;">0.00</td>
</tr>
<tr class="odd">
<td style="text-align: left;">h_obs</td>
<td style="text-align: right;">0.88</td>
<td style="text-align: right;">0.42</td>
<td style="text-align: right;">0.05</td>
<td style="text-align: right;">1.00</td>
<td style="text-align: right;">0.63</td>
<td style="text-align: right;">0.80</td>
</tr>
<tr class="even">
<td style="text-align: left;">c_obs</td>
<td style="text-align: right;">0.24</td>
<td style="text-align: right;">0.78</td>
<td style="text-align: right;">0.39</td>
<td style="text-align: right;">0.92</td>
<td style="text-align: right;">0.34</td>
<td style="text-align: right;">0.98</td>
</tr>
<tr class="odd">
<td style="text-align: left;">i_obs</td>
<td style="text-align: right;">0.61</td>
<td style="text-align: right;">0.54</td>
<td style="text-align: right;">2.12</td>
<td style="text-align: right;">0.04</td>
<td style="text-align: right;">0.31</td>
<td style="text-align: right;">0.99</td>
</tr>
<tr class="even">
<td style="text-align: left;">reer_obs</td>
<td style="text-align: right;">2.21</td>
<td style="text-align: right;">0.12</td>
<td style="text-align: right;">1.52</td>
<td style="text-align: right;">0.16</td>
<td style="text-align: right;">1.61</td>
<td style="text-align: right;">0.10</td>
</tr>
</tbody>
</table>


</div>
</div>
</figure>
</div>
</div>
</section>
</section>
<section id="sec-var-irfs" class="level2" data-number="8.4">
<h2 data-number="8.4" class="anchored" data-anchor-id="sec-var-irfs"><span class="header-section-number">8.4</span> IRFs</h2>
<p>We now turn to the impulse response functions. We set the number of lags for the impulse response analysis to 30.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>last_lag <span class="ot">&lt;-</span> <span class="dv">30</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To calculate confidence intervals, we perform Monte Carlo simulations, with 10,000 runs.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>runs <span class="ot">&lt;-</span> <span class="dv">10000</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<details class="code-fold">
<summary>The <code class="sourceCode r"><span class="fu">irf_varest</span>()</code>, <code class="sourceCode r"><span class="fu">irf_internal</span>()</code>, and <code class="sourceCode r"><span class="fu">boot_internal</span>()</code> functions.</summary>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This set of functions is the replication of the code found in the function</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="co"># irf.varest package vars to compute the IRFs.</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="co"># But we correct it so that it works with restricted vars.</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' irf_varest</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>irf_varest <span class="ot">&lt;-</span> <span class="cf">function</span>(x,</span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>                       <span class="at">impulse =</span> <span class="cn">NULL</span>,</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">response =</span> <span class="cn">NULL</span>,</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">n.ahead =</span> <span class="dv">10</span>,</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ortho =</span> <span class="cn">TRUE</span>,</span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">cumulative =</span> <span class="cn">FALSE</span>,</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>                       <span class="at">boot =</span> <span class="cn">TRUE</span>,</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a>                       <span class="at">ci =</span> <span class="fl">0.95</span>,</span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a>                       <span class="at">runs =</span> <span class="dv">100</span>,</span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a>                       <span class="at">seed =</span> <span class="cn">NULL</span>,</span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>                       <span class="at">restrict =</span> <span class="cn">NULL</span>, ...) {</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(<span class="fu">class</span>(x) <span class="sc">==</span> <span class="st">"varest"</span>)) {</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Please provide an object of class 'varest', generated by 'VAR()'.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>  y.names <span class="ot">&lt;-</span> <span class="fu">colnames</span>(x<span class="sc">$</span>y)</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(impulse)) {</span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a>    impulse <span class="ot">&lt;-</span> y.names</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>    impulse <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">as.character</span>(impulse))</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span>(impulse <span class="sc">%in%</span> y.names))) {</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Please provide variables names in impulse</span><span class="sc">\n</span><span class="st">that are in the set of endogenous variables.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-27"><a href="#cb56-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-28"><a href="#cb56-28" aria-hidden="true" tabindex="-1"></a>    impulse <span class="ot">&lt;-</span> <span class="fu">subset</span>(y.names, <span class="at">subset =</span> y.names <span class="sc">%in%</span> impulse)</span>
<span id="cb56-29"><a href="#cb56-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-30"><a href="#cb56-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(response)) {</span>
<span id="cb56-31"><a href="#cb56-31" aria-hidden="true" tabindex="-1"></a>    response <span class="ot">&lt;-</span> y.names</span>
<span id="cb56-32"><a href="#cb56-32" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb56-33"><a href="#cb56-33" aria-hidden="true" tabindex="-1"></a>    response <span class="ot">&lt;-</span> <span class="fu">as.vector</span>(<span class="fu">as.character</span>(response))</span>
<span id="cb56-34"><a href="#cb56-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">any</span>(<span class="sc">!</span>(response <span class="sc">%in%</span> y.names))){</span>
<span id="cb56-35"><a href="#cb56-35" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Please provide variables names in response</span><span class="sc">\n</span><span class="st">that are in the set of endogenous variables.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-36"><a href="#cb56-36" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-37"><a href="#cb56-37" aria-hidden="true" tabindex="-1"></a>    response <span class="ot">&lt;-</span> <span class="fu">subset</span>(y.names, <span class="at">subset =</span> y.names <span class="sc">%in%</span> response)</span>
<span id="cb56-38"><a href="#cb56-38" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-39"><a href="#cb56-39" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Getting the irf</span></span>
<span id="cb56-40"><a href="#cb56-40" aria-hidden="true" tabindex="-1"></a>  irs <span class="ot">&lt;-</span> <span class="fu">irf_internal</span>(</span>
<span id="cb56-41"><a href="#cb56-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> x,</span>
<span id="cb56-42"><a href="#cb56-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">impulse =</span> impulse,</span>
<span id="cb56-43"><a href="#cb56-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">response =</span> response,</span>
<span id="cb56-44"><a href="#cb56-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">y.names =</span> y.names,</span>
<span id="cb56-45"><a href="#cb56-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">n.ahead =</span> n.ahead,</span>
<span id="cb56-46"><a href="#cb56-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">ortho =</span> ortho,</span>
<span id="cb56-47"><a href="#cb56-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">cumulative =</span> cumulative</span>
<span id="cb56-48"><a href="#cb56-48" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb56-49"><a href="#cb56-49" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Bootstrapping</span></span>
<span id="cb56-50"><a href="#cb56-50" aria-hidden="true" tabindex="-1"></a>  Lower <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb56-51"><a href="#cb56-51" aria-hidden="true" tabindex="-1"></a>  Upper <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb56-52"><a href="#cb56-52" aria-hidden="true" tabindex="-1"></a>  std_err <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb56-53"><a href="#cb56-53" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (boot) {</span>
<span id="cb56-54"><a href="#cb56-54" aria-hidden="true" tabindex="-1"></a>    ci <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(ci)</span>
<span id="cb56-55"><a href="#cb56-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>((ci <span class="sc">&lt;=</span> <span class="dv">0</span>)<span class="sc">|</span>(ci <span class="sc">&gt;=</span> <span class="dv">1</span>)){</span>
<span id="cb56-56"><a href="#cb56-56" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">Please provide a number between 0 and 1 for the confidence interval.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-57"><a href="#cb56-57" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-58"><a href="#cb56-58" aria-hidden="true" tabindex="-1"></a>    ci <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> ci</span>
<span id="cb56-59"><a href="#cb56-59" aria-hidden="true" tabindex="-1"></a>    BOOT <span class="ot">&lt;-</span> <span class="fu">boot_internal</span>(<span class="at">x =</span> x, <span class="at">n.ahead =</span> n.ahead, <span class="at">runs =</span> runs, <span class="at">ortho =</span> ortho, <span class="at">cumulative =</span> cumulative, <span class="at">impulse =</span> impulse, <span class="at">response =</span> response, <span class="at">ci =</span> ci, <span class="at">seed =</span> seed, <span class="at">y.names =</span> y.names, <span class="at">restrict =</span> restrict)</span>
<span id="cb56-60"><a href="#cb56-60" aria-hidden="true" tabindex="-1"></a>    Lower <span class="ot">&lt;-</span> BOOT<span class="sc">$</span>Lower</span>
<span id="cb56-61"><a href="#cb56-61" aria-hidden="true" tabindex="-1"></a>    Upper <span class="ot">&lt;-</span> BOOT<span class="sc">$</span>Upper</span>
<span id="cb56-62"><a href="#cb56-62" aria-hidden="true" tabindex="-1"></a>    std_err <span class="ot">&lt;-</span> BOOT<span class="sc">$</span>sd</span>
<span id="cb56-63"><a href="#cb56-63" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-64"><a href="#cb56-64" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb56-65"><a href="#cb56-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">irf =</span> irs,</span>
<span id="cb56-66"><a href="#cb56-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">Lower =</span> Lower,</span>
<span id="cb56-67"><a href="#cb56-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">Upper =</span> Upper,</span>
<span id="cb56-68"><a href="#cb56-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">sd =</span> std_err,</span>
<span id="cb56-69"><a href="#cb56-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">response =</span> response,</span>
<span id="cb56-70"><a href="#cb56-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">impulse =</span> impulse,</span>
<span id="cb56-71"><a href="#cb56-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">ortho =</span> ortho,</span>
<span id="cb56-72"><a href="#cb56-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">cumulative =</span> cumulative,</span>
<span id="cb56-73"><a href="#cb56-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">runs =</span> runs, <span class="at">ci =</span> ci,</span>
<span id="cb56-74"><a href="#cb56-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">boot =</span> boot,</span>
<span id="cb56-75"><a href="#cb56-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">model =</span> <span class="fu">class</span>(x)</span>
<span id="cb56-76"><a href="#cb56-76" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb56-77"><a href="#cb56-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">class</span>(result) <span class="ot">&lt;-</span> <span class="st">"varirf"</span></span>
<span id="cb56-78"><a href="#cb56-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-79"><a href="#cb56-79" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb56-80"><a href="#cb56-80" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-81"><a href="#cb56-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-82"><a href="#cb56-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-83"><a href="#cb56-83" aria-hidden="true" tabindex="-1"></a><span class="co">#' irf (internal)</span></span>
<span id="cb56-84"><a href="#cb56-84" aria-hidden="true" tabindex="-1"></a>irf_internal <span class="ot">&lt;-</span> <span class="cf">function</span>(x,</span>
<span id="cb56-85"><a href="#cb56-85" aria-hidden="true" tabindex="-1"></a>                         impulse,</span>
<span id="cb56-86"><a href="#cb56-86" aria-hidden="true" tabindex="-1"></a>                         response,</span>
<span id="cb56-87"><a href="#cb56-87" aria-hidden="true" tabindex="-1"></a>                         y.names,</span>
<span id="cb56-88"><a href="#cb56-88" aria-hidden="true" tabindex="-1"></a>                         n.ahead,</span>
<span id="cb56-89"><a href="#cb56-89" aria-hidden="true" tabindex="-1"></a>                         ortho,</span>
<span id="cb56-90"><a href="#cb56-90" aria-hidden="true" tabindex="-1"></a>                         cumulative) {</span>
<span id="cb56-91"><a href="#cb56-91" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> ((<span class="fu">class</span>(x) <span class="sc">==</span> <span class="st">"varest"</span>) <span class="sc">||</span> (<span class="fu">class</span>(x) <span class="sc">==</span> <span class="st">"vec2var"</span>)) {</span>
<span id="cb56-92"><a href="#cb56-92" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(ortho){</span>
<span id="cb56-93"><a href="#cb56-93" aria-hidden="true" tabindex="-1"></a>      irf <span class="ot">&lt;-</span> <span class="fu">Psi</span>(x, <span class="at">nstep =</span> n.ahead)</span>
<span id="cb56-94"><a href="#cb56-94" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb56-95"><a href="#cb56-95" aria-hidden="true" tabindex="-1"></a>      irf <span class="ot">&lt;-</span> <span class="fu">Phi</span>(x, <span class="at">nstep =</span> n.ahead)</span>
<span id="cb56-96"><a href="#cb56-96" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-97"><a href="#cb56-97" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> ((<span class="fu">class</span>(x) <span class="sc">==</span> <span class="st">"svarest"</span>) <span class="sc">||</span> (<span class="fu">class</span>(x) <span class="sc">==</span> <span class="st">"svecest"</span>)) {</span>
<span id="cb56-98"><a href="#cb56-98" aria-hidden="true" tabindex="-1"></a>    irf <span class="ot">&lt;-</span> <span class="fu">Phi</span>(x, <span class="at">nstep =</span> n.ahead)</span>
<span id="cb56-99"><a href="#cb56-99" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-100"><a href="#cb56-100" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dimnames</span>(irf) <span class="ot">&lt;-</span> <span class="fu">list</span>(y.names, y.names, <span class="cn">NULL</span>)</span>
<span id="cb56-101"><a href="#cb56-101" aria-hidden="true" tabindex="-1"></a>  idx <span class="ot">&lt;-</span> <span class="fu">length</span>(impulse)</span>
<span id="cb56-102"><a href="#cb56-102" aria-hidden="true" tabindex="-1"></a>  irs <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb56-103"><a href="#cb56-103" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span> idx) {</span>
<span id="cb56-104"><a href="#cb56-104" aria-hidden="true" tabindex="-1"></a>    irs[[i]] <span class="ot">&lt;-</span> <span class="fu">matrix</span>(</span>
<span id="cb56-105"><a href="#cb56-105" aria-hidden="true" tabindex="-1"></a>      <span class="fu">t</span>(irf[response , impulse[i], <span class="dv">1</span> <span class="sc">:</span> (n.ahead <span class="sc">+</span> <span class="dv">1</span>)]),</span>
<span id="cb56-106"><a href="#cb56-106" aria-hidden="true" tabindex="-1"></a>      <span class="at">nrow =</span> n.ahead<span class="sc">+</span><span class="dv">1</span></span>
<span id="cb56-107"><a href="#cb56-107" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-108"><a href="#cb56-108" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(irs[[i]]) <span class="ot">&lt;-</span> response</span>
<span id="cb56-109"><a href="#cb56-109" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (cumulative) {</span>
<span id="cb56-110"><a href="#cb56-110" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">length</span>(response) <span class="sc">&gt;</span> <span class="dv">1</span>) irs[[i]] <span class="ot">&lt;-</span> <span class="fu">apply</span>(irs[[i]], <span class="dv">2</span>, cumsum)</span>
<span id="cb56-111"><a href="#cb56-111" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">length</span>(response) <span class="sc">==</span> <span class="dv">1</span>){</span>
<span id="cb56-112"><a href="#cb56-112" aria-hidden="true" tabindex="-1"></a>        tmp <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">cumsum</span>(irs[[<span class="dv">1</span>]]))</span>
<span id="cb56-113"><a href="#cb56-113" aria-hidden="true" tabindex="-1"></a>        <span class="fu">colnames</span>(tmp) <span class="ot">&lt;-</span> response</span>
<span id="cb56-114"><a href="#cb56-114" aria-hidden="true" tabindex="-1"></a>        irs[[<span class="dv">1</span>]] <span class="ot">&lt;-</span> tmp</span>
<span id="cb56-115"><a href="#cb56-115" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb56-116"><a href="#cb56-116" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-117"><a href="#cb56-117" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-118"><a href="#cb56-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(irs) <span class="ot">&lt;-</span> impulse</span>
<span id="cb56-119"><a href="#cb56-119" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> irs</span>
<span id="cb56-120"><a href="#cb56-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-121"><a href="#cb56-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb56-122"><a href="#cb56-122" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb56-123"><a href="#cb56-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-124"><a href="#cb56-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-125"><a href="#cb56-125" aria-hidden="true" tabindex="-1"></a><span class="co">#' boot_internal</span></span>
<span id="cb56-126"><a href="#cb56-126" aria-hidden="true" tabindex="-1"></a><span class="co">#' Bootstrapping IRF for VAR and SVAR</span></span>
<span id="cb56-127"><a href="#cb56-127" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb56-128"><a href="#cb56-128" aria-hidden="true" tabindex="-1"></a>boot_internal <span class="ot">&lt;-</span> <span class="cf">function</span>(x,</span>
<span id="cb56-129"><a href="#cb56-129" aria-hidden="true" tabindex="-1"></a>                          n.ahead,</span>
<span id="cb56-130"><a href="#cb56-130" aria-hidden="true" tabindex="-1"></a>                          runs,</span>
<span id="cb56-131"><a href="#cb56-131" aria-hidden="true" tabindex="-1"></a>                          ortho,</span>
<span id="cb56-132"><a href="#cb56-132" aria-hidden="true" tabindex="-1"></a>                          cumulative,</span>
<span id="cb56-133"><a href="#cb56-133" aria-hidden="true" tabindex="-1"></a>                          impulse,</span>
<span id="cb56-134"><a href="#cb56-134" aria-hidden="true" tabindex="-1"></a>                          response,</span>
<span id="cb56-135"><a href="#cb56-135" aria-hidden="true" tabindex="-1"></a>                          ci,</span>
<span id="cb56-136"><a href="#cb56-136" aria-hidden="true" tabindex="-1"></a>                          seed,</span>
<span id="cb56-137"><a href="#cb56-137" aria-hidden="true" tabindex="-1"></a>                          y.names,</span>
<span id="cb56-138"><a href="#cb56-138" aria-hidden="true" tabindex="-1"></a>                          <span class="at">restrict =</span> <span class="cn">NULL</span>) {</span>
<span id="cb56-139"><a href="#cb56-139" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span>(<span class="fu">is.null</span>(seed))) <span class="fu">set.seed</span>(<span class="fu">abs</span>(<span class="fu">as.integer</span>(seed)))</span>
<span id="cb56-140"><a href="#cb56-140" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">class</span>(x) <span class="sc">==</span> <span class="st">"varest"</span>) {</span>
<span id="cb56-141"><a href="#cb56-141" aria-hidden="true" tabindex="-1"></a>    VAR <span class="ot">&lt;-</span> <span class="fu">eval.parent</span>(x)</span>
<span id="cb56-142"><a href="#cb56-142" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">class</span>(x) <span class="sc">==</span> <span class="st">"svarest"</span>) {</span>
<span id="cb56-143"><a href="#cb56-143" aria-hidden="true" tabindex="-1"></a>    VAR <span class="ot">&lt;-</span> <span class="fu">eval.parent</span>(x<span class="sc">$</span>var)</span>
<span id="cb56-144"><a href="#cb56-144" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb56-145"><a href="#cb56-145" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"Bootstrap not implemented for this class.</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb56-146"><a href="#cb56-146" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-147"><a href="#cb56-147" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> VAR<span class="sc">$</span>p</span>
<span id="cb56-148"><a href="#cb56-148" aria-hidden="true" tabindex="-1"></a>  K <span class="ot">&lt;-</span> VAR<span class="sc">$</span>K</span>
<span id="cb56-149"><a href="#cb56-149" aria-hidden="true" tabindex="-1"></a>  obs <span class="ot">&lt;-</span> VAR<span class="sc">$</span>obs</span>
<span id="cb56-150"><a href="#cb56-150" aria-hidden="true" tabindex="-1"></a>  total <span class="ot">&lt;-</span> VAR<span class="sc">$</span>totobs</span>
<span id="cb56-151"><a href="#cb56-151" aria-hidden="true" tabindex="-1"></a>  type <span class="ot">&lt;-</span> VAR<span class="sc">$</span>type</span>
<span id="cb56-152"><a href="#cb56-152" aria-hidden="true" tabindex="-1"></a>  B <span class="ot">&lt;-</span> <span class="fu">Bcoef</span>(VAR)</span>
<span id="cb56-153"><a href="#cb56-153" aria-hidden="true" tabindex="-1"></a>  BOOT <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, runs)</span>
<span id="cb56-154"><a href="#cb56-154" aria-hidden="true" tabindex="-1"></a>  ysampled <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> total, <span class="at">ncol =</span> K)</span>
<span id="cb56-155"><a href="#cb56-155" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(ysampled) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(VAR<span class="sc">$</span>y)</span>
<span id="cb56-156"><a href="#cb56-156" aria-hidden="true" tabindex="-1"></a>  Zdet <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb56-157"><a href="#cb56-157" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">ncol</span>(VAR<span class="sc">$</span>datamat) <span class="sc">&gt;</span> (K <span class="sc">*</span> (p<span class="sc">+</span><span class="dv">1</span>))) {</span>
<span id="cb56-158"><a href="#cb56-158" aria-hidden="true" tabindex="-1"></a>    Zdet <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(VAR<span class="sc">$</span>datamat[, (K <span class="sc">*</span> (p <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="fu">ncol</span>(VAR<span class="sc">$</span>datamat)])</span>
<span id="cb56-159"><a href="#cb56-159" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-160"><a href="#cb56-160" aria-hidden="true" tabindex="-1"></a>  resorig <span class="ot">&lt;-</span> <span class="fu">scale</span>(<span class="fu">resid</span>(VAR), <span class="at">scale =</span> <span class="cn">FALSE</span>)</span>
<span id="cb56-161"><a href="#cb56-161" aria-hidden="true" tabindex="-1"></a>  B <span class="ot">&lt;-</span> <span class="fu">Bcoef</span>(VAR)</span>
<span id="cb56-162"><a href="#cb56-162" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>runs) {</span>
<span id="cb56-163"><a href="#cb56-163" aria-hidden="true" tabindex="-1"></a>    booted <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="dv">1</span> <span class="sc">:</span> obs), <span class="at">replace=</span><span class="cn">TRUE</span>)</span>
<span id="cb56-164"><a href="#cb56-164" aria-hidden="true" tabindex="-1"></a>    resid <span class="ot">&lt;-</span> resorig[booted, ]</span>
<span id="cb56-165"><a href="#cb56-165" aria-hidden="true" tabindex="-1"></a>    lasty <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">t</span>(VAR<span class="sc">$</span>y[p <span class="sc">:</span> <span class="dv">1</span>, ]))</span>
<span id="cb56-166"><a href="#cb56-166" aria-hidden="true" tabindex="-1"></a>    ysampled[<span class="fu">c</span>(<span class="dv">1</span> <span class="sc">:</span> p), ] <span class="ot">&lt;-</span> VAR<span class="sc">$</span>y[<span class="fu">c</span>(<span class="dv">1</span> <span class="sc">:</span> p), ]</span>
<span id="cb56-167"><a href="#cb56-167" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(j <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span> obs){</span>
<span id="cb56-168"><a href="#cb56-168" aria-hidden="true" tabindex="-1"></a>      lasty <span class="ot">&lt;-</span> lasty[<span class="dv">1</span> <span class="sc">:</span> (K <span class="sc">*</span> p)]</span>
<span id="cb56-169"><a href="#cb56-169" aria-hidden="true" tabindex="-1"></a>      Z <span class="ot">&lt;-</span> <span class="fu">c</span>(lasty, Zdet[j, ])</span>
<span id="cb56-170"><a href="#cb56-170" aria-hidden="true" tabindex="-1"></a>      ysampled[j <span class="sc">+</span> p, ] <span class="ot">&lt;-</span> B <span class="sc">%*%</span> Z <span class="sc">+</span> resid[j, ]</span>
<span id="cb56-171"><a href="#cb56-171" aria-hidden="true" tabindex="-1"></a>      lasty <span class="ot">&lt;-</span> <span class="fu">c</span>(ysampled[j <span class="sc">+</span> p, ], lasty)</span>
<span id="cb56-172"><a href="#cb56-172" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-173"><a href="#cb56-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-174"><a href="#cb56-174" aria-hidden="true" tabindex="-1"></a>    varboot <span class="ot">&lt;-</span> <span class="fu">update</span>(VAR, <span class="at">y =</span> ysampled)</span>
<span id="cb56-175"><a href="#cb56-175" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(restrict))</span>
<span id="cb56-176"><a href="#cb56-176" aria-hidden="true" tabindex="-1"></a>      varboot <span class="ot">&lt;-</span> <span class="fu">restrict</span>(varboot, <span class="at">method =</span> <span class="st">"man"</span>, <span class="at">resmat =</span> restrict)</span>
<span id="cb56-177"><a href="#cb56-177" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">class</span>(x) <span class="sc">==</span> <span class="st">"svarest"</span>) {</span>
<span id="cb56-178"><a href="#cb56-178" aria-hidden="true" tabindex="-1"></a>      varboot <span class="ot">&lt;-</span> <span class="fu">update</span>(x, <span class="at">x =</span> varboot)</span>
<span id="cb56-179"><a href="#cb56-179" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-180"><a href="#cb56-180" aria-hidden="true" tabindex="-1"></a>    BOOT[[i]] <span class="ot">&lt;-</span> <span class="fu">irf_internal</span>(</span>
<span id="cb56-181"><a href="#cb56-181" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> varboot,</span>
<span id="cb56-182"><a href="#cb56-182" aria-hidden="true" tabindex="-1"></a>      <span class="at">n.ahead =</span> n.ahead,</span>
<span id="cb56-183"><a href="#cb56-183" aria-hidden="true" tabindex="-1"></a>      <span class="at">ortho =</span> ortho,</span>
<span id="cb56-184"><a href="#cb56-184" aria-hidden="true" tabindex="-1"></a>      <span class="at">cumulative =</span> cumulative,</span>
<span id="cb56-185"><a href="#cb56-185" aria-hidden="true" tabindex="-1"></a>      <span class="at">impulse =</span> impulse,</span>
<span id="cb56-186"><a href="#cb56-186" aria-hidden="true" tabindex="-1"></a>      <span class="at">response =</span> response,</span>
<span id="cb56-187"><a href="#cb56-187" aria-hidden="true" tabindex="-1"></a>      <span class="at">y.names =</span> y.names</span>
<span id="cb56-188"><a href="#cb56-188" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb56-189"><a href="#cb56-189" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-190"><a href="#cb56-190" aria-hidden="true" tabindex="-1"></a>  lower <span class="ot">&lt;-</span> ci <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb56-191"><a href="#cb56-191" aria-hidden="true" tabindex="-1"></a>  upper <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> ci <span class="sc">/</span> <span class="dv">2</span></span>
<span id="cb56-192"><a href="#cb56-192" aria-hidden="true" tabindex="-1"></a>  mat.l <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n.ahead <span class="sc">+</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="fu">length</span>(response))</span>
<span id="cb56-193"><a href="#cb56-193" aria-hidden="true" tabindex="-1"></a>  mat.u <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n.ahead <span class="sc">+</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="fu">length</span>(response))</span>
<span id="cb56-194"><a href="#cb56-194" aria-hidden="true" tabindex="-1"></a>  mat.sd <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="cn">NA</span>, <span class="at">nrow =</span> n.ahead <span class="sc">+</span> <span class="dv">1</span>, <span class="at">ncol =</span> <span class="fu">length</span>(response))</span>
<span id="cb56-195"><a href="#cb56-195" aria-hidden="true" tabindex="-1"></a>  Lower <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb56-196"><a href="#cb56-196" aria-hidden="true" tabindex="-1"></a>  Upper <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb56-197"><a href="#cb56-197" aria-hidden="true" tabindex="-1"></a>  std_err <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb56-198"><a href="#cb56-198" aria-hidden="true" tabindex="-1"></a>  idx1 <span class="ot">&lt;-</span> <span class="fu">length</span>(impulse)</span>
<span id="cb56-199"><a href="#cb56-199" aria-hidden="true" tabindex="-1"></a>  idx2 <span class="ot">&lt;-</span> <span class="fu">length</span>(response)</span>
<span id="cb56-200"><a href="#cb56-200" aria-hidden="true" tabindex="-1"></a>  idx3 <span class="ot">&lt;-</span> n.ahead <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb56-201"><a href="#cb56-201" aria-hidden="true" tabindex="-1"></a>  temp <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, runs)</span>
<span id="cb56-202"><a href="#cb56-202" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (j <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span> idx1) {</span>
<span id="cb56-203"><a href="#cb56-203" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (m <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span> idx2) {</span>
<span id="cb56-204"><a href="#cb56-204" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (l <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span> idx3) {</span>
<span id="cb56-205"><a href="#cb56-205" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span> <span class="sc">:</span> runs) {</span>
<span id="cb56-206"><a href="#cb56-206" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (idx2 <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb56-207"><a href="#cb56-207" aria-hidden="true" tabindex="-1"></a>            temp[i] <span class="ot">&lt;-</span> BOOT[[i]][[j]][l, m]</span>
<span id="cb56-208"><a href="#cb56-208" aria-hidden="true" tabindex="-1"></a>          } <span class="cf">else</span> {</span>
<span id="cb56-209"><a href="#cb56-209" aria-hidden="true" tabindex="-1"></a>            temp[i] <span class="ot">&lt;-</span> <span class="fu">matrix</span>(BOOT[[i]][[j]])[l, m]</span>
<span id="cb56-210"><a href="#cb56-210" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb56-211"><a href="#cb56-211" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb56-212"><a href="#cb56-212" aria-hidden="true" tabindex="-1"></a>        mat.l[l, m] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(temp, lower, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-213"><a href="#cb56-213" aria-hidden="true" tabindex="-1"></a>        mat.u[l, m] <span class="ot">&lt;-</span> <span class="fu">quantile</span>(temp, upper, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-214"><a href="#cb56-214" aria-hidden="true" tabindex="-1"></a>        mat.sd[l, m] <span class="ot">&lt;-</span> <span class="fu">sd</span>(temp, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb56-215"><a href="#cb56-215" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb56-216"><a href="#cb56-216" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb56-217"><a href="#cb56-217" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(mat.l) <span class="ot">&lt;-</span> response</span>
<span id="cb56-218"><a href="#cb56-218" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(mat.u) <span class="ot">&lt;-</span> response</span>
<span id="cb56-219"><a href="#cb56-219" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(mat.sd) <span class="ot">&lt;-</span> response</span>
<span id="cb56-220"><a href="#cb56-220" aria-hidden="true" tabindex="-1"></a>    Lower[[j]] <span class="ot">&lt;-</span> mat.l</span>
<span id="cb56-221"><a href="#cb56-221" aria-hidden="true" tabindex="-1"></a>    Upper[[j]] <span class="ot">&lt;-</span> mat.u</span>
<span id="cb56-222"><a href="#cb56-222" aria-hidden="true" tabindex="-1"></a>    std_err[[j]] <span class="ot">&lt;-</span> mat.sd</span>
<span id="cb56-223"><a href="#cb56-223" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb56-224"><a href="#cb56-224" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Lower) <span class="ot">&lt;-</span> impulse</span>
<span id="cb56-225"><a href="#cb56-225" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(Upper) <span class="ot">&lt;-</span> impulse</span>
<span id="cb56-226"><a href="#cb56-226" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(std_err) <span class="ot">&lt;-</span> impulse</span>
<span id="cb56-227"><a href="#cb56-227" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">Lower =</span> Lower, <span class="at">Upper =</span> Upper, <span class="at">sd =</span> std_err)</span>
<span id="cb56-228"><a href="#cb56-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-229"><a href="#cb56-229" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(result)</span>
<span id="cb56-230"><a href="#cb56-230" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>Compute the IRFs (pointwise estimations):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>irfs <span class="ot">&lt;-</span> <span class="fu">irf</span>(</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  svar_est,</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">n.ahead =</span> last_lag,</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">boot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">cumulative =</span> <span class="cn">FALSE</span>,</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">ortho =</span> <span class="cn">TRUE</span>,</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">seed =</span> <span class="dv">1</span></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="monte-carlo-simulations" class="level3" data-number="8.4.1">
<h3 data-number="8.4.1" class="anchored" data-anchor-id="monte-carlo-simulations"><span class="header-section-number">8.4.1</span> Monte Carlo Simulations</h3>
<p>We define a function, <code class="sourceCode r"><span class="fu">irfs_mc</span>()</code>, which draws multiple shocks from a Normal distribution for a given shocked variable and compute the response to the system for each of the shocks.</p>
<p>The simulated responses are summarized into 68% and 95% credible intervals: <span class="math display">\[
  \text{IRF}_{h}^{(s)} = \varepsilon_s \cdot \text{IRF}_h,
  \quad \varepsilon_s \sim \mathcal{N}(0,1)
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Returns a tibble with the IRFs values for a shocked variable</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' and the credible intervals as computed with Monte-Carlo simulations</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param irfs IRFs obtained with `irf_varest()`</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param var_shocked Name of the variable shocked in `irfs$irf`</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param runs No. draws for the Monte-Carlo simulations (default: 10,000)</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>irfs_mc <span class="ot">&lt;-</span> <span class="cf">function</span>(var_shocked,</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>                    irfs,</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>                    <span class="at">runs =</span> <span class="dv">10000</span>) {</span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  sim <span class="ot">&lt;-</span> <span class="fu">vector</span>(<span class="st">"list"</span>, runs)</span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  n_variables <span class="ot">&lt;-</span> <span class="fu">ncol</span>(irfs<span class="sc">$</span>irf[[var_shocked]])</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(sim)) {</span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">ncol =</span> n_variables, <span class="at">nrow =</span> <span class="fu">nrow</span>(irfs<span class="sc">$</span>irf[[var_shocked]]))</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>    x[<span class="dv">1</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">abs</span>(<span class="fu">rnorm</span>(<span class="at">n =</span> <span class="dv">1</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>))) <span class="co"># Generate a random shock</span></span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>    sim[[i]] <span class="ot">&lt;-</span> x[<span class="dv">1</span>,<span class="dv">1</span>] <span class="sc">*</span> irfs<span class="sc">$</span>irf[[var_shocked]] <span class="sc">|&gt;</span> <span class="fu">as_tibble</span>()</span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>    sim[[i]]<span class="sc">$</span>horizon <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(irfs<span class="sc">$</span>irf[[var_shocked]])</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>  sim <span class="ot">&lt;-</span></span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>    sim <span class="sc">|&gt;</span> <span class="fu">bind_rows</span>() <span class="sc">|&gt;</span></span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gather</span>(var_response, value, <span class="sc">-</span>horizon) <span class="sc">|&gt;</span></span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(horizon, var_response) <span class="sc">|&gt;</span></span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(</span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean =</span> <span class="fu">mean</span>(value),</span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd =</span> <span class="fu">sd</span>(value),</span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower_95 =</span> <span class="fu">quantile</span>(value, <span class="at">probs =</span> .<span class="dv">05</span>),</span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper_95 =</span> <span class="fu">quantile</span>(value, <span class="at">probs =</span> .<span class="dv">95</span>),</span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower_68 =</span> <span class="fu">quantile</span>(value, <span class="at">probs =</span> .<span class="dv">32</span>),</span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper_68 =</span> <span class="fu">quantile</span>(value, <span class="at">probs =</span> .<span class="dv">68</span>),</span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">var_shocked =</span> <span class="sc">!!</span>var_shocked) <span class="sc">|&gt;</span></span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">value =</span> mean)</span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>  sim</span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>In the function <code class="sourceCode r"><span class="fu">irfs_mc</span>()</code>, since <code>irfs$irf[[var_shocked]]</code> already gives the response to a one–standard deviation shock, multiplying by a random <span class="math inline">\(\mathcal{N}(0,1)\)</span> means that we are simulating IRFs for random shock magnitudes drawn in standard deviation units. So the simulated values are expressed in the same units as the variables themselves (e.g., percentage deviations, log-deviations, etc.), per one-standard deviation of the shocked variable.</p>
<p>In our model, since the macro variables are detrended and expressed as log-deviations from trend, the IRFs of the weather shock measure approximatively the percentage responses to a one standard-deviation drought shock.</p>
</div>
</div>
<p>We apply this function to perform 10,000 draws so as to get the 0.95% and 68% credible intervals for the IRFs to a shock to the weather variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This takes about 30sec to run</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>df_irfs <span class="ot">&lt;-</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># pbapply::pblapply(names(irfs$irf), irfs_mc, irfs = irfs) |&gt;</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lapply</span>(<span class="fu">names</span>(irfs<span class="sc">$</span>irf), irfs_mc, <span class="at">irfs =</span> irfs) <span class="sc">|&gt;</span></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">bind_rows</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Let us have a look at the beginning of these IRFs. We begin with looking at the response of the rest-of-the-world GDP, which is supposed to be 0 because of all our restrictions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>df_irfs <span class="sc">|&gt;</span> <span class="fu">filter</span>(var_shocked <span class="sc">==</span> <span class="st">"smdi_obs"</span>, var_response <span class="sc">==</span> <span class="st">"wy_obs"</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
  horizon var_response value    sd lower_95 upper_95 lower_68 upper_68
    &lt;int&gt; &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1       1 wy_obs           0     0        0        0        0        0
2       2 wy_obs           0     0        0        0        0        0
3       3 wy_obs           0     0        0        0        0        0
4       4 wy_obs           0     0        0        0        0        0
5       5 wy_obs           0     0        0        0        0        0
6       6 wy_obs           0     0        0        0        0        0
# ℹ 1 more variable: var_shocked &lt;chr&gt;</code></pre>
</div>
</div>
<p>The response of national GDP:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>df_irfs <span class="sc">|&gt;</span> <span class="fu">filter</span>(var_shocked <span class="sc">==</span> <span class="st">"smdi_obs"</span>, var_response <span class="sc">==</span> <span class="st">"y_obs"</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
  horizon var_response   value     sd lower_95 upper_95 lower_68 upper_68
    &lt;int&gt; &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1       1 y_obs        -0.0521 0.0221  -0.0888  -0.0160  -0.0631  -0.0407
2       2 y_obs        -0.177  0.0750  -0.301   -0.0542  -0.214   -0.138 
3       3 y_obs        -0.195  0.0829  -0.333   -0.0599  -0.237   -0.153 
4       4 y_obs        -0.160  0.0678  -0.272   -0.0490  -0.194   -0.125 
5       5 y_obs        -0.117  0.0496  -0.199   -0.0359  -0.142   -0.0913
6       6 y_obs        -0.0820 0.0348  -0.140   -0.0252  -0.0994  -0.0641
# ℹ 1 more variable: var_shocked &lt;chr&gt;</code></pre>
</div>
</div>
<p>The response of hours worked:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>df_irfs <span class="sc">|&gt;</span> <span class="fu">filter</span>(var_shocked <span class="sc">==</span> <span class="st">"smdi_obs"</span>, var_response <span class="sc">==</span> <span class="st">"h_obs"</span>) <span class="sc">|&gt;</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
  horizon var_response   value     sd lower_95 upper_95 lower_68 upper_68
    &lt;int&gt; &lt;chr&gt;          &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1       1 h_obs        -0.128  0.0541   -0.218  -0.0391   -0.155  -0.0996
2       2 h_obs        -0.132  0.0560   -0.225  -0.0405   -0.160  -0.103 
3       3 h_obs        -0.128  0.0544   -0.219  -0.0393   -0.155  -0.100 
4       4 h_obs        -0.116  0.0494   -0.198  -0.0357   -0.141  -0.0908
5       5 h_obs        -0.104  0.0442   -0.178  -0.0319   -0.126  -0.0813
6       6 h_obs        -0.0933 0.0396   -0.159  -0.0286   -0.113  -0.0729
# ℹ 1 more variable: var_shocked &lt;chr&gt;</code></pre>
</div>
</div>
<div class="cell">
<details class="code-fold">
<summary>The table <code>corresp_names</code> with variable names and different labels (long, short, formulas), and the table <code>possibilites</code> with all combinations of two variables.</summary>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>corresp_names <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>name_r, <span class="sc">~</span>long_name, <span class="sc">~</span>short_name, <span class="sc">~</span>pm_name,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"wy_obs"</span>, <span class="st">"Foreign Output"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">Delta log</span><span class="sc">\\</span><span class="st">left(Y_t^*</span><span class="sc">\\</span><span class="st">right)$"</span>, <span class="st">"hat(y)[t]^F"</span>,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"wp_obs"</span>, <span class="st">"Foreign CPI Inflation"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">pi_t^*$"</span>, <span class="st">"hat(pi)[t]^F"</span>,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"wr_obs"</span>, <span class="st">"Foreign Interest Rate"</span>, <span class="st">"r_t^*"</span>, <span class="st">"hat(r)[t]^F"</span>,</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"wp_a_obs"</span>, <span class="st">"Foreign Ag. Price Infl."</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">Delta log </span><span class="sc">\\</span><span class="st">left(p_t^{A*}</span><span class="sc">\\</span><span class="st">right)$"</span>, <span class="st">"p[t]^D"</span>,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"wy_a_obs"</span>, <span class="st">"Foreign Ag. Output"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">Delta log </span><span class="sc">\\</span><span class="st">left(Y_t^{A*}</span><span class="sc">\\</span><span class="st">right)$"</span>, <span class="st">"Y[t]^D"</span>,</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"oil_obs"</span>, <span class="st">"Crude Oil Inflation"</span>, <span class="st">"$oil_t$"</span>, <span class="st">"hat(oil)[t]"</span>,</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"y_obs"</span>, <span class="st">"Output"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">Delta log </span><span class="sc">\\</span><span class="st">left(Y_t^d</span><span class="sc">\\</span><span class="st">right)$"</span>, <span class="st">"hat(y)[t]"</span>,</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"y_a_obs"</span>, <span class="st">"Ag. Output"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">Delta log </span><span class="sc">\\</span><span class="st">left(X_t^A</span><span class="sc">\\</span><span class="st">right)$"</span>, <span class="st">"hat(y)[t]^A"</span>,</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"p_obs"</span>, <span class="st">"CPI Inflation"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">pi_t^C$"</span>, <span class="st">"hat(pi)[t]"</span>,</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ratio_p_obs"</span>, <span class="st">"Rel. Prices"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">pi_{x,t}^A / </span><span class="sc">\\</span><span class="st">pi_t^C$"</span>, <span class="st">"hat(pi)[t] / hat(pi)[t]^A"</span>,</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"p_a_obs"</span>, <span class="st">"Ag. Inflation"</span>, <span class="st">"$log </span><span class="sc">\\</span><span class="st">left(</span><span class="sc">\\</span><span class="st">pi_{x,t}^A</span><span class="sc">\\</span><span class="st">right)$"</span>, <span class="st">"hat(pi)[t]^A"</span>,</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"c_obs"</span>, <span class="st">"Consumption"</span>, <span class="st">"$log </span><span class="sc">\\</span><span class="st">left(c_{t}</span><span class="sc">\\</span><span class="st">right)$"</span>, <span class="st">"hat(c)[t]"</span>,</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"h_obs"</span>, <span class="st">"Hours Worked"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">Delta log </span><span class="sc">\\</span><span class="st">left($h_t</span><span class="sc">\\</span><span class="st">right)$"</span>, <span class="st">"hat(h)[t]"</span>,</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"i_obs"</span>, <span class="st">"Investment"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">Delta log </span><span class="sc">\\</span><span class="st">left(i_t</span><span class="sc">\\</span><span class="st">right)$"</span>, <span class="st">"hat(i)[t]"</span>,</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">"q_obs"</span>, <span class="st">"Stock Prices"</span>, <span class="st">"q_t"</span>, <span class="st">"hat(q)[t]"</span>,</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a>  <span class="st">"im_obs"</span>, <span class="st">"Imports"</span>, <span class="st">"</span><span class="sc">\\</span><span class="st">Delta log </span><span class="sc">\\</span><span class="st">left(im_{t}</span><span class="sc">\\</span><span class="st">right)$"</span>, <span class="st">"hat(im)[t]"</span>,</span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>  <span class="st">"x_obs"</span>, <span class="st">"Exports"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">Delta log </span><span class="sc">\\</span><span class="st">left(x_{t}</span><span class="sc">\\</span><span class="st">right)$"</span>, <span class="st">"hat(x)[t]"</span>,</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tb_obs"</span>, <span class="st">"Trade Balance"</span>, <span class="st">"$tb_{t}$"</span>, <span class="st">"hat(tb)[t]"</span>,</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ex_rate_obs"</span>, <span class="st">"Real Ex. Rate"</span>, <span class="st">"$rer_t$"</span>, <span class="st">"hat(e)[t]"</span>,</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>  <span class="st">"reer_obs"</span>, <span class="st">"Real Eff. Ex. Rate"</span>, <span class="st">"$reer_$"</span>, <span class="st">"hat(e)[t]"</span>,</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>  <span class="st">"r_obs"</span>, <span class="st">"Interest Rate"</span>, <span class="st">"$r_t$"</span>, <span class="st">"hat(r)[t]"</span>,</span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>  <span class="st">"smdi_obs"</span>, <span class="st">"Weather"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">varepsilon_{t}^{W}$"</span>, <span class="st">"hat(s)[t]"</span>,</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a>  <span class="st">"r_y_hp"</span>, <span class="st">"GDP Deviation From HP Filter Trend"</span>, <span class="st">"$y_t$"</span>, <span class="st">"y[t]"</span>,</span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>  <span class="st">"r_y_a_hp"</span>, <span class="st">"agricultural GDP Deviation From HP Filter Trend"</span>, <span class="st">"$y_t^A$"</span>, <span class="st">"y[t]^A"</span>,</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>  <span class="st">"smdi"</span>, <span class="st">"Wheater"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">varepsilon_{t}^{W}$"</span>, <span class="st">"hat(s)[t]"</span>,</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a>  <span class="st">"y_w"</span>, <span class="st">"Foreign Output"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">Delta log</span><span class="sc">\\</span><span class="st">left(Y_t^*</span><span class="sc">\\</span><span class="st">right)$"</span>, <span class="st">"hat(y)[t]^F"</span>,</span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>  <span class="st">"y"</span>, <span class="st">"Output"</span>, <span class="st">"$</span><span class="sc">\\</span><span class="st">Delta log </span><span class="sc">\\</span><span class="st">left(Y_t^d</span><span class="sc">\\</span><span class="st">right)$"</span>, <span class="st">"hat(y)[t]"</span></span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a><span class="co"># We put the variables in a specific order when creating `corresp_names`.</span></span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Let us make sure, by casting column `name_r` as a factor, that the order is</span></span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a><span class="co"># preserved.</span></span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a>noms_ordonnees <span class="ot">&lt;-</span> corresp_names<span class="sc">$</span>name_r</span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>corresp_names <span class="ot">&lt;-</span></span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>  corresp_names <span class="sc">|&gt;</span></span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">name_r =</span> <span class="fu">factor</span>(name_r, <span class="at">levels =</span> noms_ordonnees))</span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a><span class="co"># Listing all possible subsets of 2 variables</span></span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>possibilites <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>  <span class="at">Var1 =</span> <span class="fu">levels</span>(corresp_names<span class="sc">$</span>name_r),</span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a>  <span class="at">Var2 =</span> <span class="fu">levels</span>(corresp_names<span class="sc">$</span>name_r)</span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Var1, Var2) <span class="sc">|&gt;</span></span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">title =</span> <span class="fu">str_c</span>(Var1, <span class="st">"-"</span>, Var2)) <span class="sc">|&gt;</span></span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We define a small function, <code class="sourceCode r"><span class="fu">c_name</span>()</code>, to retrieve the label of a variable in the tibble <code>corresp_names</code>.</p>
<div class="cell">
<details class="code-fold">
<summary>The <code class="sourceCode r"><span class="fu">c_name</span>()</code> function.</summary>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Returns the label of a variable by looking it up in `corresp_names`</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param x Variable name (column `name_r` in `corresp_names`)</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param type Type of desired label (`"pm"`, `"short"`, `"long"`). See details.</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' @returns A character vector with the label of the variable.</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a><span class="co">#' @details</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a><span class="co">#' The desired type corresponds to the prefix of the column names of</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a><span class="co">#' `corresp_names`: `"pm"` for R formulas, `"short"` for LaTeX formulas, and</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="co">#' `"long"` for a string describing the variable.</span></span>
<span id="cb67-10"><a href="#cb67-10" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb67-11"><a href="#cb67-11" aria-hidden="true" tabindex="-1"></a><span class="co">#' @examples</span></span>
<span id="cb67-12"><a href="#cb67-12" aria-hidden="true" tabindex="-1"></a><span class="co">#' c_name("wy_obs", "pm")</span></span>
<span id="cb67-13"><a href="#cb67-13" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb67-14"><a href="#cb67-14" aria-hidden="true" tabindex="-1"></a>c_name <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">type =</span> <span class="fu">c</span>(<span class="st">"pm"</span>, <span class="st">"short"</span>, <span class="st">"long"</span>)){</span>
<span id="cb67-15"><a href="#cb67-15" aria-hidden="true" tabindex="-1"></a>  type <span class="ot">&lt;-</span> <span class="fu">match.arg</span>(type)</span>
<span id="cb67-16"><a href="#cb67-16" aria-hidden="true" tabindex="-1"></a>  type <span class="ot">&lt;-</span> type <span class="sc">%&gt;%</span> <span class="fu">str_c</span>(<span class="st">"_name"</span>)</span>
<span id="cb67-17"><a href="#cb67-17" aria-hidden="true" tabindex="-1"></a>  ind <span class="ot">&lt;-</span> <span class="fu">match</span>(x, corresp_names<span class="sc">$</span>name_r)</span>
<span id="cb67-18"><a href="#cb67-18" aria-hidden="true" tabindex="-1"></a>  corresp_names[ind, ] <span class="sc">|&gt;</span> <span class="fu">pull</span>(type)</span>
<span id="cb67-19"><a href="#cb67-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>We define a function, <code class="sourceCode r"><span class="fu">get_df_plot</span>()</code> to reshape the IRFs results for later use in a ggplot graph.</p>
<div class="cell">
<details class="code-fold">
<summary>The <code class="sourceCode r"><span class="fu">get_df_plot</span>()</code></summary>
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Reshape IRF table</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>get_df_plot <span class="ot">&lt;-</span> <span class="cf">function</span>(df_irfs) {</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>  df_plot <span class="ot">&lt;-</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    df_irfs <span class="sc">|&gt;</span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">str_c</span>(var_shocked, <span class="st">"-"</span>, var_response),</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">title2 =</span> <span class="fu">str_c</span>(</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c_name</span>(var_shocked, <span class="at">type =</span> <span class="st">"pm"</span>), <span class="st">" %-&gt;% "</span>,</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>        <span class="fu">c_name</span>(var_response, <span class="at">type =</span> <span class="st">"pm"</span>)</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">factor</span>(title, <span class="at">levels =</span> possibilites<span class="sc">$</span>title)</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(title) <span class="sc">|&gt;</span></span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">|&gt;</span></span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">lower =</span> lower_95, <span class="at">upper =</span> upper_95) <span class="sc">|&gt;</span></span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">lower =</span> <span class="fu">as.numeric</span>(lower),</span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">upper =</span> <span class="fu">as.numeric</span>(upper),</span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">var_shocked =</span> <span class="fu">factor</span>(var_shocked, <span class="at">levels =</span> corresp_names<span class="sc">$</span>name_r),</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">var_response =</span> <span class="fu">factor</span>(var_response, <span class="at">levels =</span> corresp_names<span class="sc">$</span>name_r)</span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">|&gt;</span></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(var_shocked, var_response, horizon)</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a>  ordered_titles <span class="ot">&lt;-</span> df_plot <span class="sc">|&gt;</span> <span class="fu">pull</span>(<span class="st">"title2"</span>) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-27"><a href="#cb68-27" aria-hidden="true" tabindex="-1"></a>  df_plot <span class="ot">&lt;-</span></span>
<span id="cb68-28"><a href="#cb68-28" aria-hidden="true" tabindex="-1"></a>    df_plot <span class="sc">|&gt;</span></span>
<span id="cb68-29"><a href="#cb68-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">title2 =</span> <span class="fu">factor</span>(title2, <span class="at">levels =</span> ordered_titles))</span>
<span id="cb68-30"><a href="#cb68-30" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>df_irfs_plot <span class="ot">&lt;-</span> <span class="fu">get_df_plot</span>(df_irfs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The plot with all the IRFs is shown in <a href="#fig-irf-all" class="quarto-xref">Figure&nbsp;<span>8.1</span></a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Codes to create the Figure.</summary>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># IRFs with all the shocked variables</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="co"># **Beware**: this may take a lot of time to be displayed</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="co"># And requires a very large screen</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> df_irfs_plot <span class="sc">|&gt;</span></span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unite</span>(values_95, lower, upper, <span class="at">sep =</span> <span class="st">"@"</span>) <span class="sc">|&gt;</span></span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unite</span>(values_68, lower_68, upper_68, <span class="at">sep =</span> <span class="st">"@"</span>) <span class="sc">|&gt;</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gather</span>(band, value_bounds, values_95, values_68) <span class="sc">|&gt;</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">separate</span>(value_bounds, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"lower"</span>, <span class="st">"upper"</span>), <span class="at">sep =</span> <span class="st">"@"</span>, <span class="at">convert =</span> T),</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> horizon, <span class="at">y =</span> value)</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper,</span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">fill =</span> band, <span class="at">group =</span> band), <span class="at">alpha =</span> .<span class="dv">5</span></span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> horizon, <span class="at">y =</span> lower, <span class="at">group =</span> band, <span class="at">linetype =</span> band)) <span class="sc">+</span></span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> horizon, <span class="at">y =</span> upper, <span class="at">group =</span> band, <span class="at">linetype =</span> band)) <span class="sc">+</span></span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> title2, <span class="at">scales=</span><span class="st">"free_y"</span>, <span class="at">labeller =</span> label_parsed) <span class="sc">+</span></span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">name=</span><span class="st">"C.I. Level"</span>,</span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"values_95"</span> <span class="ot">=</span> <span class="st">"#1E90FF"</span>, <span class="st">"values_68"</span> <span class="ot">=</span> <span class="st">"#005A9C"</span>),</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"values_95"</span> <span class="ot">=</span> <span class="st">"95%"</span>, <span class="st">"values_68"</span> <span class="ot">=</span> <span class="st">"68%"</span>)</span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb70-28"><a href="#cb70-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(</span>
<span id="cb70-29"><a href="#cb70-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">name=</span><span class="st">"C.I. Level"</span>,</span>
<span id="cb70-30"><a href="#cb70-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"values_95"</span> <span class="ot">=</span> <span class="st">"dashed"</span>, <span class="st">"values_68"</span> <span class="ot">=</span> <span class="st">"dotted"</span>),</span>
<span id="cb70-31"><a href="#cb70-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"values_95"</span> <span class="ot">=</span> <span class="st">"95%"</span>, <span class="st">"values_68"</span> <span class="ot">=</span> <span class="st">"68%"</span>)</span>
<span id="cb70-32"><a href="#cb70-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb70-33"><a href="#cb70-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb70-34"><a href="#cb70-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="cn">NA</span>),</span>
<span id="cb70-35"><a href="#cb70-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb70-36"><a href="#cb70-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>)</span>
<span id="cb70-37"><a href="#cb70-37" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb70-38"><a href="#cb70-38" aria-hidden="true" tabindex="-1"></a>p</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-irf-all" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-irf-all-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.1: VAR impulse response to a standard shock. Shocked variables are in rows.
</figcaption>
<div aria-describedby="fig-irf-all-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="var-estimation_files/figure-html/fig-irf-all-1.png" class="img-fluid figure-img" width="1920">
</div>
</figure>
</div>
</div>
</div>
<p>It is more useful to create a function that will only display the IRFs for one equation.</p>
<div class="cell">
<details class="code-fold">
<summary>The <code class="sourceCode r"><span class="fu">print_irf</span>()</code> function.</summary>
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="co">#' Displays the IRFs for one equation</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a><span class="co">#'</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param df_plot (data.frame) the data containing the IRFs (obtained from get_df_plot())</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a><span class="co">#' @param shocked variable shocked</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a><span class="co">#' df_plot &lt;- df_irfs_plot ; shocked &lt;- "smdi_obs" ; ci &lt;- 95</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>print_irf <span class="ot">&lt;-</span> <span class="cf">function</span>(df_plot, shocked) {</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>  df_tmp <span class="ot">&lt;-</span></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>    df_plot <span class="sc">|&gt;</span></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(var_shocked <span class="sc">==</span> <span class="sc">!!</span>shocked) <span class="sc">|&gt;</span></span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">title2 =</span> <span class="fu">c_name</span>(var_response, <span class="at">type =</span> <span class="st">"pm"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(var_shocked, var_response, horizon)</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>  ordered_titles <span class="ot">&lt;-</span> df_tmp <span class="sc">|&gt;</span> <span class="fu">pull</span>(<span class="st">"title2"</span>) <span class="sc">|&gt;</span> <span class="fu">unique</span>()</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>  df_tmp <span class="ot">&lt;-</span></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a>    df_tmp <span class="sc">|&gt;</span></span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">title2 =</span> <span class="fu">factor</span>(title2, <span class="at">levels =</span> ordered_titles))</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(</span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> df_tmp <span class="sc">|&gt;</span></span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unite</span>(values_95, lower, upper, <span class="at">sep =</span> <span class="st">"@"</span>) <span class="sc">|&gt;</span></span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">unite</span>(values_68, lower_68, upper_68, <span class="at">sep =</span> <span class="st">"@"</span>) <span class="sc">|&gt;</span></span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">gather</span>(band, value_bounds, values_95, values_68) <span class="sc">|&gt;</span></span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">separate</span>(value_bounds, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">"lower"</span>, <span class="st">"upper"</span>), <span class="at">sep =</span> <span class="st">"@"</span>, <span class="at">convert =</span> T),</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> horizon, <span class="at">y =</span> value)</span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb71-28"><a href="#cb71-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(</span>
<span id="cb71-29"><a href="#cb71-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper, <span class="at">fill =</span> band, <span class="at">group =</span> band),</span>
<span id="cb71-30"><a href="#cb71-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">alpha=</span>.<span class="dv">5</span></span>
<span id="cb71-31"><a href="#cb71-31" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb71-32"><a href="#cb71-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb71-33"><a href="#cb71-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> horizon, <span class="at">y =</span> lower, <span class="at">group =</span> band, <span class="at">linetype =</span> band)) <span class="sc">+</span></span>
<span id="cb71-34"><a href="#cb71-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> horizon, <span class="at">y =</span> upper, <span class="at">group =</span> band, <span class="at">linetype =</span> band)) <span class="sc">+</span></span>
<span id="cb71-35"><a href="#cb71-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>title2, <span class="at">scales=</span><span class="st">"free"</span>, <span class="at">labeller =</span> label_parsed) <span class="sc">+</span></span>
<span id="cb71-36"><a href="#cb71-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb71-37"><a href="#cb71-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb71-38"><a href="#cb71-38" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_manual</span>(</span>
<span id="cb71-39"><a href="#cb71-39" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"C.I. Level"</span>,</span>
<span id="cb71-40"><a href="#cb71-40" aria-hidden="true" tabindex="-1"></a>      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"values_95"</span> <span class="ot">=</span> <span class="st">"#1E90FF"</span>, <span class="st">"values_68"</span> <span class="ot">=</span> <span class="st">"#005A9C"</span>),</span>
<span id="cb71-41"><a href="#cb71-41" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"values_95"</span> <span class="ot">=</span> <span class="st">"95%"</span>, <span class="st">"values_68"</span> <span class="ot">=</span> <span class="st">"68%"</span>)</span>
<span id="cb71-42"><a href="#cb71-42" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb71-43"><a href="#cb71-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype_manual</span>(</span>
<span id="cb71-44"><a href="#cb71-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">name=</span><span class="st">"C.I. Level"</span>,</span>
<span id="cb71-45"><a href="#cb71-45" aria-hidden="true" tabindex="-1"></a>      <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"values_95"</span> <span class="ot">=</span> <span class="st">"dashed"</span>, <span class="st">"values_68"</span> <span class="ot">=</span> <span class="st">"dotted"</span>),</span>
<span id="cb71-46"><a href="#cb71-46" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"values_95"</span> <span class="ot">=</span> <span class="st">"95%"</span>, <span class="st">"values_68"</span> <span class="ot">=</span> <span class="st">"68%"</span>)</span>
<span id="cb71-47"><a href="#cb71-47" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb71-48"><a href="#cb71-48" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb71-49"><a href="#cb71-49" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="cn">NA</span>),</span>
<span id="cb71-50"><a href="#cb71-50" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb71-51"><a href="#cb71-51" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">25</span>)</span>
<span id="cb71-52"><a href="#cb71-52" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb71-53"><a href="#cb71-53" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>The response of the system to a 1-sd shock to the weather variable is shown in <a href="#fig-irf-smdi" class="quarto-xref">Figure&nbsp;<span>8.2</span></a>.</p>
<div class="cell">
<details class="code-fold">
<summary>Codes to create the Figure.</summary>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print_irf</span>(<span class="at">shocked =</span> <span class="st">"smdi_obs"</span>, <span class="at">df_plot =</span> df_irfs_plot) <span class="sc">+</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">20</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div id="fig-irf-smdi" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-fig" id="fig-irf-smdi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;8.2: VAR impulse response to a standard drought shock. For macro variables expressed in log-deviations from their trend, the y-axis represents, approximatively, the percentage response to a one-standard deviation weather shock.
</figcaption>
<div aria-describedby="fig-irf-smdi-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="var-estimation_files/figure-html/fig-irf-smdi-1.png" class="img-fluid figure-img" width="960">
</div>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Export the IRFs</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>readr<span class="sc">::</span><span class="fu">write_csv</span>(df_irfs, <span class="at">file =</span> <span class="st">"../data/var_irfs_ebook.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./data-climate-projections.html" class="pagination-link" aria-label="Climate Projection">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Climate Projection</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./dsge-theory.html" class="pagination-link" aria-label="The Theoretical Model">
        <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">The Theoretical Model</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>